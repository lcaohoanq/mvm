import{a0 as re,r as s,a as L,j as e,L as he,B as l,G as M,x as D,T as c,d as H,e as Y,a1 as xe,F as ue,S as me,f as E,a2 as oe,a3 as ie,b as ce,a4 as pe,h as X,a5 as fe,V as q,u as ge,U as Z,W as O,X as Q,Y as ee,Z as _,_ as te,$ as se}from"./index-D08WwhE9.js";import{A as ye}from"./AccessTime-BRbQzV45.js";import{a as ae,v as be,T as je,b as ve,R as Ce}from"./vi-CdoHM020.js";import{f as k}from"./format-csk1fyom.js";import{S as we,P as Se,a as Te}from"./pagination-78XLot3l.js";const ke=({onMovieLoad:p})=>{const{movieId:x}=re(),[t,f]=s.useState(),[u,m]=s.useState(!0),{t:j}=L(),b=async()=>{try{m(!0);const i=await Y.get(`movie/${x}`);f(i.data.data),p&&p(i.data.data),console.log("Movie detail:",i.data.data)}catch(i){console.error("Failed to fetch movie:",i)}finally{console.log(x+"haha"),m(!1)}};s.useEffect(()=>{b()},[j]);const C=i=>{if(!i)return"N/A";const w={day:"2-digit",month:"2-digit",year:"numeric"};return new Date(i).toLocaleDateString("vi-VN",w)};return u?e.jsx(he,{}):e.jsx(l,{sx:{bgcolor:"background.paper",color:"text.primary"},children:e.jsxs(M,{container:!0,spacing:4,sx:{alignItems:"stretch"},children:[e.jsx(M,{item:!0,xs:12,md:4,children:e.jsx(D,{elevation:2,sx:{p:1,height:"100%"},children:e.jsx(l,{component:"img",src:t==null?void 0:t.image,alt:t==null?void 0:t.movieName,sx:{width:"100%",height:"100%",borderRadius:1,objectFit:"contain"}})})}),e.jsxs(M,{item:!0,xs:12,md:8,sx:{display:"flex",flexDirection:"column"},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",mb:2,children:t==null?void 0:t.movieName}),e.jsxs(l,{sx:{mb:3},children:[e.jsx(H,{label:t==null?void 0:t.rating,color:"error",sx:{mb:1,mr:1}}),e.jsx(H,{icon:e.jsx(ye,{}),label:`${t==null?void 0:t.duration}'`,sx:{mr:1,mb:1},color:"default"}),e.jsx(H,{label:t==null?void 0:t.categories.map(i=>i.name).join(", "),sx:{mr:1,mb:1,backgroundColor:"red",color:"white"}})]}),e.jsx(c,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"M√î T·∫¢"}),e.jsxs(l,{sx:{mb:3,textAlign:"justify",flexGrow:1},children:[e.jsxs(c,{mb:1,variant:"body2",children:[e.jsx("strong",{children:"ƒê·∫°o di·ªÖn:"})," ",t==null?void 0:t.director]}),e.jsxs(c,{mb:1,variant:"body2",sx:{textAlign:"left"},children:[e.jsx("strong",{children:"Di·ªÖn vi√™n:"})," ",t==null?void 0:t.actors]}),e.jsxs(c,{mb:1,variant:"body2",children:[e.jsx("strong",{children:"Kh·ªüi chi·∫øu:"})," ",C(t==null?void 0:t.fromDate)]}),e.jsx(c,{variant:"subtitle1",fontWeight:"bold",mb:1,mt:2,children:"N·ªòI DUNG PHIM"}),e.jsx(c,{paragraph:!0,variant:"body2",sx:{textAlign:"justify"},children:t==null?void 0:t.content})]})]})]})})},$=new Map,De=({movieId:p,onRoomSelect:x,onSelectDate:t,onSelectTime:f,onShowtimeAvailability:u})=>{const m=new Date,j=k(m,"dd/MM"),[b,C]=s.useState(j),[i,w]=s.useState("hcm"),[S,a]=s.useState(null),[o,d]=s.useState([]),[W,I]=s.useState(!1),{t:g,i18n:A}=L(),N=s.useRef(null),n=s.useMemo(()=>Array.from({length:4},(r,h)=>{const y=ae(m,h),P=k(y,"EEEE",{locale:A.language==="vi"?be:void 0});return{date:y,formatted:k(y,"dd/MM"),label:g(`${P.toLowerCase()}`)}}),[m,g,A.language]),z=s.useCallback((r,h)=>{h&&(C(h),t(h),a(null))},[t]),F=r=>$.get(r);s.useEffect(()=>{t(j)},[t,j]);const G=s.useCallback((r,h)=>{a({time:r,id:h}),f(r),x(h),sessionStorage.setItem("currentShowTimeId",h)},[f,x]);return s.useEffect(()=>{const r=n.find(R=>R.formatted===b);if(!r)return;const h=k(r.date,"yyyy-MM-dd"),y=k(ae(r.date,3),"yyyy-MM-dd"),P=k(r.date,"yyyy-MM-dd"),V=`${p}_${h}_${i}`;let B=!0;const le=async()=>{const R=F(V);if(R){B&&(d(R),I(!1),u(R.length>0));return}I(!0);try{const J=await Y.get(`showtime/${p}/from/${h}/to/${y}/locate/${i.toUpperCase()}`);if(!B)return;const T=J.data.data[P];if(!T||!T[i.toUpperCase()]||T[i.toUpperCase()].length===0){const v=[];d(v),$.set(V,v),u(!1);return}const U=T[i.toUpperCase()].map(v=>({name:v.nameTheater,address:v.addressTheater,times:v.listShowTime.map(K=>({time:k(new Date(K.startTime),"HH:mm"),showTimeId:K.showTimeId}))})).filter(v=>v.name&&v.times&&v.times.length>0);d(U),$.set(V,U),u(U.length>0)}catch{const T=[];d(T),$.set(V,T),u(!1)}finally{B&&I(!1)}},de=setTimeout(()=>{le()},300);return()=>{B=!1,clearTimeout(de)}},[i,b,n,p,u]),s.useEffect(()=>{const r=o.length>0;N.current!==r&&(N.current=r,u(r))},[o.length,u]),e.jsx(l,{sx:{bgcolor:"background.paper",color:"text.primary",py:3},children:e.jsxs(l,{maxWidth:"md",sx:{mx:"auto"},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",textAlign:"center",mb:3,children:g("showtime_cinema.title.showtime_list")}),e.jsx(je,{value:b,exclusive:!0,onChange:z,sx:{display:"flex",justifyContent:"center",gap:2,mb:3,flexWrap:"wrap"},children:n.map((r,h)=>{const y=r.formatted===j;return e.jsxs(ve,{value:r.formatted,sx:{border:"1px solid",borderColor:"primary.main",color:"primary.main","&.Mui-selected":{backgroundColor:"primary.main",color:"white",fontWeight:"bold"},"&.Mui-selected:hover":{backgroundColor:"primary.dark"},borderRadius:"8px",px:3,py:1.5,minWidth:"90px",position:"relative"},children:[y&&e.jsx(c,{variant:"caption",sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",backgroundColor:"error.main",color:"white",borderRadius:"4px",px:.5,fontWeight:"bold",whiteSpace:"nowrap"},children:g("showtime_cinema.title.now_day")}),e.jsxs(l,{textAlign:"center",children:[e.jsx(c,{variant:"h6",fontWeight:"bold",mb:1,children:r.formatted}),e.jsx(c,{variant:"body2",children:r.label})]})]},h)})}),e.jsxs(M,{container:!0,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(M,{item:!0,children:e.jsxs(c,{variant:"h6",fontWeight:"bold",children:["üé¨ ",g("showtime_cinema.title.theater_list")]})}),e.jsx(M,{item:!0,children:e.jsx(ue,{size:"small",children:e.jsxs(me,{value:i,onChange:r=>w(r.target.value),sx:{borderRadius:"8px",minWidth:"120px"},children:[e.jsx(E,{value:"hcm",children:g("showtime_cinema.location.HCM")}),e.jsx(E,{value:"hn",children:g("showtime_cinema.location.HaNoi")}),e.jsx(E,{value:"bd",children:g("showtime_cinema.location.BinhDuong")}),e.jsx(E,{value:"bp",children:g("showtime_cinema.location.BinhPhuoc")})]})})})]}),!W&&e.jsx(l,{sx:{borderRadius:"12px"},children:o.length>0?o.map((r,h)=>e.jsx(oe,{sx:{borderRadius:"8px",p:2,mb:2,boxShadow:2},children:e.jsxs(ie,{children:[e.jsx(c,{variant:"h6",fontWeight:"bold",color:"primary",mb:1,children:r.name}),e.jsx(c,{variant:"body2",mb:2,color:"text.secondary",children:r.address}),e.jsx(l,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:r.times.map((y,P)=>e.jsx(ce,{variant:(S==null?void 0:S.time)===y.time?"contained":"outlined",size:"small",sx:{fontWeight:"bold",minWidth:"70px"},onClick:()=>G(y.time,y.showTimeId),children:y.time},P))})]})},h)):e.jsx(c,{variant:"body1",textAlign:"center",sx:{py:5,color:"text.secondary"},children:g("showtime_cinema.title.no_showtime")})})]})})},Me=xe.memo(De),ne={en:{locale:"en-US",currency:"USD"},jp:{locale:"ja-JP",currency:"JPY"},vi:{locale:"vi-VN",currency:"VND"}},We={VND:1,USD:39e-6,JPY:.0058},Ie=({onNext:p})=>{const[x,t]=s.useState([]),{t:f,i18n:u}=L();pe();const[m,j]=s.useState({locale:"vi-VN",currency:"VND"});s.useEffect(()=>{const o=u.language.substring(0,2);j(ne[o]||ne.vi)},[u.language]),s.useEffect(()=>{(async()=>{try{const d=(await Y.get("seattype")).data.data.map(W=>({...W,quantity:0}));t(d)}catch(o){console.error("Error fetching seat types:",o),q.error(f("errors.fetch_seats_failed"))}})()},[f]);const b=a=>{t(o=>o.map(d=>d.seatTypeId===a?{...d,quantity:d.quantity+1}:d))},C=a=>{t(o=>o.map(d=>d.seatTypeId===a&&d.quantity>0?{...d,quantity:d.quantity-1}:d))},i=(a,o)=>o==="VND"?a:a*We[o],w=a=>{const o=i(a,m.currency);return(m.currency==="JPY"?Math.round(o):o).toLocaleString(m.locale,{style:"currency",currency:m.currency})},S=()=>{const a=x.filter(o=>o.quantity>0);if(a.length===0){q.error("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt v√©.");return}p&&p(a)};return e.jsxs(l,{sx:{padding:{xs:2,sm:3},textAlign:"center"},children:[e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",mb:4,color:"text.primary"},children:f("ticket_price.ticket_selection")}),e.jsx(l,{sx:{width:"100%",maxWidth:"900px",margin:"0 auto",overflow:"hidden",position:"relative"},children:e.jsx(we,{slidesPerView:1,spaceBetween:20,pagination:{clickable:!0},breakpoints:{600:{slidesPerView:2},900:{slidesPerView:3}},autoplay:{delay:1e3},loop:x.length>4,modules:[Se],style:{width:"100%",margin:"0 auto",paddingBottom:"30px"},children:x.map(a=>e.jsx(Te,{children:e.jsx(oe,{elevation:2,sx:{borderRadius:2,textAlign:"center",p:2,height:"100%",transition:"transform 0.2s ease","&:hover":{transform:"translateY(-4px)"},boxShadow:2},children:e.jsxs(ie,{children:[e.jsx(c,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:a.typeName}),e.jsx(c,{variant:"body1",sx:{color:"primary.main",fontWeight:"bold",mb:2},children:w(a.price)}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mt:2},children:[e.jsx(X,{onClick:()=>C(a.seatTypeId),color:"primary",disabled:a.quantity===0,size:"small",children:e.jsx(Ce,{})}),e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",mx:2,minWidth:"30px"},children:a.quantity}),e.jsx(X,{onClick:()=>b(a.seatTypeId),color:"primary",size:"small",children:e.jsx(fe,{})})]})]})})},a.seatTypeId))})}),p&&e.jsx(l,{sx:{mt:4},children:e.jsx(ce,{variant:"contained",color:"primary",sx:{fontWeight:"bold",px:4,py:1},onClick:S,children:f("ticket_price.next")})})]})},Be=()=>{const p=ge(),{movieId:x}=re(),{t}=L(),[f,u]=s.useState(null),[m,j]=s.useState(""),[b,C]=s.useState(null),[i,w]=s.useState(""),[S,a]=s.useState(!1),[o]=s.useState(!1),d=s.useCallback(n=>{w(n)},[]),W=s.useCallback(n=>{j(n)},[]),I=s.useCallback(n=>{C(n)},[]),g=s.useCallback(n=>{a(n)},[]),A=s.useCallback(n=>{u(n)},[]),N=s.useCallback(n=>{if(!b){q.error("Vui l√≤ng ch·ªçn su·∫•t chi·∫øu!");return}if(n.reduce((F,G)=>F+(G.quantity||0),0)===0){q.error("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 v√©!");return}p("/admin/ql-ban-ve/movie-seat",{state:{movieId:x,showTimeId:i,selectedDate:m,selectedTime:b,tickets:n,movieData:f}})},[x,p,i,m,b,f]);return x?e.jsxs(Z,{disableCustomTheme:o,children:[e.jsx(O,{enableColorScheme:!0}),e.jsxs(l,{sx:{display:"flex",height:"100vh"},children:[e.jsx(Q,{}),e.jsxs(l,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(ee,{}),e.jsx(l,{component:"main",sx:n=>({flexGrow:1,backgroundColor:_(n.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(te,{spacing:3,children:[e.jsx(se,{}),e.jsxs(D,{elevation:2,sx:{width:"100%",borderRadius:2},children:[e.jsx(l,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider",textAlign:"center"},children:e.jsx(c,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"ƒê·∫∑t V√© Xem Phim"})}),e.jsxs(l,{sx:{p:3},children:[e.jsx(D,{elevation:1,sx:n=>({backgroundColor:_(n.palette.background.default,.6),p:3,mb:3}),children:e.jsx(ke,{onMovieLoad:A})}),e.jsx(D,{elevation:1,sx:n=>({backgroundColor:_(n.palette.background.default,.6),p:3,mb:3}),children:e.jsx(Me,{movieId:x,onRoomSelect:d,onSelectDate:W,onSelectTime:I,onShowtimeAvailability:g})}),S&&e.jsx(D,{elevation:1,sx:n=>({backgroundColor:_(n.palette.background.default,.6),p:3}),children:e.jsx(Ie,{onNext:N})})]})]})]})})]})]})]}):e.jsxs(Z,{disableCustomTheme:o,children:[e.jsx(O,{enableColorScheme:!0}),e.jsxs(l,{sx:{display:"flex",height:"100vh"},children:[e.jsx(Q,{}),e.jsxs(l,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(ee,{}),e.jsx(l,{component:"main",sx:n=>({flexGrow:1,backgroundColor:_(n.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(te,{spacing:3,children:[e.jsx(se,{}),e.jsxs(D,{elevation:2,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[e.jsx(c,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:t("oops")}),e.jsx(c,{variant:"h6",sx:{p:4,border:2,borderColor:"error.main",color:"error.main",borderRadius:2,textAlign:"center"},children:"Phim kh√¥ng t·ªìn t·∫°i."})]})]})})]})]})]})};export{Be as default};
