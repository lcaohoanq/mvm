import{W as O,r as s,a as F,j as e,L as oe,B as o,G as w,x as _,T as i,d as P,e as Q,R as ie,F as le,S as ce,f as E,X as de,Y as xe,b as ee,u as he,V as me,Z as K,_ as V,$ as Y,a0 as X,a1 as N,a2 as q,a3 as Z}from"./index-CmSrV0e4.js";import{A as ue}from"./AccessTime-BUZ3yo-k.js";import{a as J,v as pe,T as fe,b as ge}from"./vi-BG3avUh_.js";import{f as C}from"./format-csk1fyom.js";const be=({onMovieLoad:u})=>{const{movieId:h}=O(),[t,b]=s.useState(),[x,p]=s.useState(!0),{t:g}=F(),f=async()=>{try{p(!0);const n=await Q.get(`movie/${h}`);b(n.data.data),u&&u(n.data.data),console.log("Movie detail:",n.data.data)}catch(n){console.error("Failed to fetch movie:",n)}finally{console.log(h+"haha"),p(!1)}};s.useEffect(()=>{f()},[g]);const S=n=>{if(!n)return"N/A";const k={day:"2-digit",month:"2-digit",year:"numeric"};return new Date(n).toLocaleDateString("vi-VN",k)};return x?e.jsx(oe,{}):e.jsx(o,{sx:{bgcolor:"background.paper",color:"text.primary"},children:e.jsxs(w,{container:!0,spacing:4,sx:{alignItems:"stretch"},children:[e.jsx(w,{item:!0,xs:12,md:4,children:e.jsx(_,{elevation:2,sx:{p:1,height:"100%"},children:e.jsx(o,{component:"img",src:t==null?void 0:t.image,alt:t==null?void 0:t.movieName,sx:{width:"100%",height:"100%",borderRadius:1,objectFit:"contain"}})})}),e.jsxs(w,{item:!0,xs:12,md:8,sx:{display:"flex",flexDirection:"column"},children:[e.jsx(i,{variant:"h5",fontWeight:"bold",mb:2,children:t==null?void 0:t.movieName}),e.jsxs(o,{sx:{mb:3},children:[e.jsx(P,{label:t==null?void 0:t.rating,color:"error",sx:{mb:1,mr:1}}),e.jsx(P,{icon:e.jsx(ue,{}),label:`${t==null?void 0:t.duration}'`,sx:{mr:1,mb:1},color:"default"}),e.jsx(P,{label:t==null?void 0:t.categories.map(n=>n.name).join(", "),sx:{mr:1,mb:1,backgroundColor:"red",color:"white"}})]}),e.jsx(i,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"MÔ TẢ"}),e.jsxs(o,{sx:{mb:3,textAlign:"justify",flexGrow:1},children:[e.jsxs(i,{mb:1,variant:"body2",children:[e.jsx("strong",{children:"Đạo diễn:"})," ",t==null?void 0:t.director]}),e.jsxs(i,{mb:1,variant:"body2",sx:{textAlign:"left"},children:[e.jsx("strong",{children:"Diễn viên:"})," ",t==null?void 0:t.actors]}),e.jsxs(i,{mb:1,variant:"body2",children:[e.jsx("strong",{children:"Khởi chiếu:"})," ",S(t==null?void 0:t.fromDate)]}),e.jsx(i,{variant:"subtitle1",fontWeight:"bold",mb:1,mt:2,children:"NỘI DUNG PHIM"}),e.jsx(i,{paragraph:!0,variant:"body2",sx:{textAlign:"justify"},children:t==null?void 0:t.content})]})]})]})})},G=new Map,je=({movieId:u,onRoomSelect:h,onSelectDate:t,onSelectTime:b,onShowtimeAvailability:x})=>{const p=new Date,g=C(p,"dd/MM"),[f,S]=s.useState(g),[n,k]=s.useState("hcm"),[T,R]=s.useState(null),[j,v]=s.useState([]),[L,M]=s.useState(!1),{t:c,i18n:I}=F(),B=s.useRef(null),r=s.useMemo(()=>Array.from({length:4},(a,l)=>{const d=J(p,l),D=C(d,"EEEE",{locale:I.language==="vi"?pe:void 0});return{date:d,formatted:C(d,"dd/MM"),label:c(`${D.toLowerCase()}`)}}),[p,c,I.language]),te=s.useCallback((a,l)=>{l&&(S(l),t(l),R(null))},[t]),se=a=>G.get(a);s.useEffect(()=>{t(g)},[t,g]);const ae=s.useCallback((a,l)=>{R({time:a,id:l}),b(a),h(l),sessionStorage.setItem("currentShowTimeId",l)},[b,h]);return s.useEffect(()=>{const a=r.find(W=>W.formatted===f);if(!a)return;const l=C(a.date,"yyyy-MM-dd"),d=C(J(a.date,3),"yyyy-MM-dd"),D=C(a.date,"yyyy-MM-dd"),A=`${u}_${l}_${n}`;let $=!0;const ne=async()=>{const W=se(A);if(W){$&&(v(W),M(!1),x(W.length>0));return}M(!0);try{const U=await Q.get(`showtime/${u}/from/${l}/to/${d}/locate/${n.toUpperCase()}`);if(!$)return;const y=U.data.data[D];if(!y||!y[n.toUpperCase()]||y[n.toUpperCase()].length===0){const m=[];v(m),G.set(A,m),x(!1);return}const H=y[n.toUpperCase()].map(m=>({name:m.nameTheater,address:m.addressTheater,times:m.listShowTime.map(z=>({time:C(new Date(z.startTime),"HH:mm"),showTimeId:z.showTimeId}))})).filter(m=>m.name&&m.times&&m.times.length>0);v(H),G.set(A,H),x(H.length>0)}catch{const y=[];v(y),G.set(A,y),x(!1)}finally{$&&M(!1)}},re=setTimeout(()=>{ne()},300);return()=>{$=!1,clearTimeout(re)}},[n,f,r,u,x]),s.useEffect(()=>{const a=j.length>0;B.current!==a&&(B.current=a,x(a))},[j.length,x]),e.jsx(o,{sx:{bgcolor:"background.paper",color:"text.primary",py:3},children:e.jsxs(o,{maxWidth:"md",sx:{mx:"auto"},children:[e.jsx(i,{variant:"h5",fontWeight:"bold",textAlign:"center",mb:3,children:c("showtime_cinema.title.showtime_list")}),e.jsx(fe,{value:f,exclusive:!0,onChange:te,sx:{display:"flex",justifyContent:"center",gap:2,mb:3,flexWrap:"wrap"},children:r.map((a,l)=>{const d=a.formatted===g;return e.jsxs(ge,{value:a.formatted,sx:{border:"1px solid",borderColor:"primary.main",color:"primary.main","&.Mui-selected":{backgroundColor:"primary.main",color:"white",fontWeight:"bold"},"&.Mui-selected:hover":{backgroundColor:"primary.dark"},borderRadius:"8px",px:3,py:1.5,minWidth:"90px",position:"relative"},children:[d&&e.jsx(i,{variant:"caption",sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",backgroundColor:"error.main",color:"white",borderRadius:"4px",px:.5,fontWeight:"bold",whiteSpace:"nowrap"},children:c("showtime_cinema.title.now_day")}),e.jsxs(o,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:"bold",mb:1,children:a.formatted}),e.jsx(i,{variant:"body2",children:a.label})]})]},l)})}),e.jsxs(w,{container:!0,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(w,{item:!0,children:e.jsxs(i,{variant:"h6",fontWeight:"bold",children:["🎬 ",c("showtime_cinema.title.theater_list")]})}),e.jsx(w,{item:!0,children:e.jsx(le,{size:"small",children:e.jsxs(ce,{value:n,onChange:a=>k(a.target.value),sx:{borderRadius:"8px",minWidth:"120px"},children:[e.jsx(E,{value:"hcm",children:c("showtime_cinema.location.HCM")}),e.jsx(E,{value:"hn",children:c("showtime_cinema.location.HaNoi")}),e.jsx(E,{value:"bd",children:c("showtime_cinema.location.BinhDuong")}),e.jsx(E,{value:"bp",children:c("showtime_cinema.location.BinhPhuoc")})]})})})]}),!L&&e.jsx(o,{sx:{borderRadius:"12px"},children:j.length>0?j.map((a,l)=>e.jsx(de,{sx:{borderRadius:"8px",p:2,mb:2,boxShadow:2},children:e.jsxs(xe,{children:[e.jsx(i,{variant:"h6",fontWeight:"bold",color:"primary",mb:1,children:a.name}),e.jsx(i,{variant:"body2",mb:2,color:"text.secondary",children:a.address}),e.jsx(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:a.times.map((d,D)=>e.jsx(ee,{variant:(T==null?void 0:T.time)===d.time?"contained":"outlined",size:"small",sx:{fontWeight:"bold",minWidth:"70px"},onClick:()=>ae(d.time,d.showTimeId),children:d.time},D))})]})},l)):e.jsx(i,{variant:"body1",textAlign:"center",sx:{py:5,color:"text.secondary"},children:c("showtime_cinema.title.no_showtime")})})]})})},ye=ie.memo(je),Te=()=>{const u=he(),{movieId:h}=O(),{t}=F(),[b,x]=s.useState(null),[p,g]=s.useState(""),[f,S]=s.useState(null),[n,k]=s.useState(""),[T,R]=s.useState(!1),[j]=s.useState(!1),v=s.useCallback(r=>{k(r)},[]),L=s.useCallback(r=>{g(r)},[]),M=s.useCallback(r=>{S(r)},[]),c=s.useCallback(r=>{R(r)},[]),I=s.useCallback(r=>{x(r)},[]),B=s.useCallback(()=>{if(!f){me.error(t("toast.error.showtime.selection"));return}u("/admin/ql-ban-ve/movie-seat",{state:{movieId:h,showTimeId:n,selectedDate:p,selectedTime:f,movieData:b}})},[h,u,n,p,f,b,t]);return h?e.jsxs(K,{disableCustomTheme:j,children:[e.jsx(V,{enableColorScheme:!0}),e.jsxs(o,{sx:{display:"flex",height:"100vh"},children:[e.jsx(Y,{}),e.jsxs(o,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(X,{}),e.jsx(o,{component:"main",sx:r=>({flexGrow:1,backgroundColor:N(r.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(q,{spacing:3,children:[e.jsx(Z,{}),e.jsxs(_,{elevation:2,sx:{width:"100%",borderRadius:2},children:[e.jsx(o,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider",textAlign:"center"},children:e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:t("menu.ticketBooking")})}),e.jsxs(o,{sx:{p:3},children:[e.jsx(_,{elevation:1,sx:r=>({backgroundColor:N(r.palette.background.default,.6),p:3,mb:3}),children:e.jsx(be,{onMovieLoad:I})}),e.jsx(_,{elevation:1,sx:r=>({backgroundColor:N(r.palette.background.default,.6),p:3,mb:3}),children:e.jsx(ye,{movieId:h,onRoomSelect:v,onSelectDate:L,onSelectTime:M,onShowtimeAvailability:c})}),T&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2},children:e.jsx(ee,{variant:"contained",color:"primary",size:"large",onClick:B,sx:{minWidth:200},children:t("admin.ticket_management.continue")})})]})]})]})})]})]})]}):e.jsxs(K,{disableCustomTheme:j,children:[e.jsx(V,{enableColorScheme:!0}),e.jsxs(o,{sx:{display:"flex",height:"100vh"},children:[e.jsx(Y,{}),e.jsxs(o,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(X,{}),e.jsx(o,{component:"main",sx:r=>({flexGrow:1,backgroundColor:N(r.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(q,{spacing:3,children:[e.jsx(Z,{}),e.jsxs(_,{elevation:2,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[e.jsx(i,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:t("oops")}),e.jsx(i,{variant:"h6",sx:{p:4,border:2,borderColor:"error.main",color:"error.main",borderRadius:2,textAlign:"center"},children:t("admin.ticket_management.not_existing")})]})]})})]})]})]})};export{Te as default};
