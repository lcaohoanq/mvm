import{c as J,j as e,a0 as K,u as ee,r,L as ae,U as y,W as w,B as s,X as S,Y as I,Z as C,T as i,b as c,al as n,_ as te,$ as se,C as oe,l as W,F as ne,S as re,f as $,aF as ie,aG as le,aD as H,aj as ce,ak as de,am as me,an as he,e as p}from"./index-B2eA6uDr.js";import{u as D}from"./useQuery-CZbVYsZq.js";import{A as xe}from"./AccessTime-Ba7Kfese.js";import{T as ue}from"./Theaters-DetDrdZe.js";import{A as fe}from"./AdminNowShowingMovies-6Re2qgAt.js";import{D as pe}from"./DateTimePicker-B_Oa4OBr.js";import{f as ge}from"./format-csk1fyom.js";import"./Tabs-BHJAavFr.js";const je=J(e.jsx("path",{d:"m18 4 2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4z"}),"Movie"),ke=({disableCustomTheme:g=!1})=>{var N;const{id:x}=K(),b=ee(),[l,k]=r.useState(""),[M,T]=r.useState(""),[P,u]=r.useState(!1),[m,_]=r.useState(""),[R,A]=r.useState(""),[Y,E]=r.useState(0),[z,f]=r.useState(!1),F=a=>{if(!a)return"";try{const t=new Date(a);return ge(t,"yyyy-MM-dd'T'HH:mm")}catch(t){return console.error("Error formatting date:",t),""}},{data:o,isLoading:G,error:j}=D(["showtime",x],async()=>{try{return(await p.get(`showtime/${x}`)).data}catch(a){throw console.error("Error fetching showtime:",a),a}});r.useEffect(()=>{if(o){console.log("Setting movie and room IDs from showtime:",o);const a=o.data||o;k(a.movieId||""),T(a.roomId||""),a.startTime&&_(F(a.startTime))}},[o]);const{data:h,isLoading:B}=D("movies",async()=>{var t;const a=await p.get("movie");return console.log("Movies API Response:",a.data),Array.isArray(a.data)?a.data:((t=a.data)==null?void 0:t.data)||[]}),{data:L,isLoading:O}=D("rooms",async()=>{var t;const a=await p.get("room");return console.log("Rooms API Response:",a.data),Array.isArray(a.data)?a.data:((t=a.data)==null?void 0:t.data)||[]}),q=a=>{if(k(a),u(!0),h){const t=h.find(d=>d.movieId===a);t&&(A(t.movieName),E(t.duration||120))}f(!1)};r.useEffect(()=>{if(h&&l){const a=h.find(t=>t.movieId===l);a&&(A(a.movieName),E(a.duration||120))}},[h,l]);const U=a=>{T(a.target.value),u(!0)},Q=a=>{a&&(_(a.format("YYYY-MM-DDTHH:mm")),u(!0))},V=a=>{if(!a)return"";try{const t=new Date(a),d=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:00`;return console.log(`Formatted date: ${d}`),d}catch(t){return console.error("Error formatting date:",t),a}},X=async()=>{try{if(!o)return;const a=o.data||o,t=calculateEndTime(),d={...a,movieId:l,roomId:M,startTime:V(m),endTime:t};await p.put(`showtime/${x}`,d),alert("Lịch chiếu đã được cập nhật thành công!"),u(!1)}catch(a){console.error("Error updating showtime:",a),alert("Đã xảy ra lỗi khi cập nhật lịch chiếu!")}},v=()=>{b("/admin/ql-thoi-gian-chieu")},Z=()=>{b(`/admin/ql-thoi-gian-chieu/chinh-sua/${x}`)};return G||B||O?e.jsx(ae,{}):j?e.jsxs(y,{disableCustomTheme:g,children:[e.jsx(w,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{}),e.jsxs(s,{component:"main",sx:a=>({flexGrow:1,backgroundColor:C(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:[e.jsxs(i,{color:"error",variant:"h6",children:["Error:"," ",j instanceof Error?j.message:"Unknown error"]}),e.jsx(c,{variant:"contained",onClick:v,sx:{mt:2},children:n("admin.showtime_management.come_back")})]})]})]})]}):o?e.jsxs(y,{disableCustomTheme:g,children:[e.jsx(w,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{}),e.jsx(s,{component:"main",sx:a=>({flexGrow:1,backgroundColor:C(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(te,{spacing:2,alignItems:"center",children:[e.jsx(se,{}),e.jsx(oe,{sx:{backgroundColor:"#f5f5f5",color:"#000000",py:3},children:e.jsxs(s,{sx:{mb:3},children:[e.jsxs(i,{variant:"h5",sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(ue,{sx:{mr:1}}),n("admin.showtime_management.detail.title")]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle1",children:n("admin.showtime_management.showtime_id")}),e.jsx(W,{fullWidth:!0,variant:"outlined",size:"small",value:((N=o==null?void 0:o.data)==null?void 0:N.showTimeId)||(o==null?void 0:o.showTimeId)||"",InputProps:{readOnly:!0}})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle1",children:"Phim"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(W,{fullWidth:!0,variant:"outlined",size:"small",value:R,InputProps:{readOnly:!0,startAdornment:l?e.jsx(je,{sx:{mr:1,color:"primary.main"}}):null},placeholder:n("admin.showtime_management.movie_not_selection")}),e.jsx(c,{variant:"contained",onClick:()=>f(!0),sx:{whiteSpace:"nowrap"},children:n("admin.showtime_management.movie_selection")})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle1",children:n("admin.showtime_management.room")}),e.jsx(ne,{fullWidth:!0,size:"small",children:e.jsxs(re,{value:M,onChange:U,displayEmpty:!0,children:[e.jsx($,{value:"",children:e.jsx("em",{children:n("admin.showtime_management.no_room")})}),Array.isArray(L)&&L.map(a=>e.jsx($,{value:a.roomId,children:a.roomName||a.name},a.roomId))]})})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(ie,{dateAdapter:le,children:e.jsx(pe,{value:m?H(m):null,onChange:Q,referenceDate:H("2022-04-17T15:30")})}),e.jsxs(i,{children:["Stored value: ",m??"null"]})]}),l&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle1",children:"Thời lượng"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",bgcolor:"#e8f4fd",px:2,py:1.5,borderRadius:1,border:"1px solid",borderColor:"info.light"},children:[e.jsx(xe,{sx:{mr:1,color:"info.main"}}),e.jsxs(i,{variant:"body1",sx:{fontWeight:"medium"},children:[Y," phút"]})]})]}),e.jsxs(s,{sx:{mt:3,display:"flex",justifyContent:"center",gap:2},children:[P?e.jsx(c,{variant:"contained",color:"success",size:"large",onClick:X,sx:{minWidth:150},children:n("admin.showtime_management.save")}):e.jsx(c,{variant:"contained",color:"primary",size:"large",onClick:Z,sx:{minWidth:150},children:n("admin.showtime_management.edit")}),e.jsx(c,{variant:"outlined",size:"large",onClick:v,sx:{minWidth:150},children:n("admin.showtime_management.come_back")})]})]})})]})})]})]}),e.jsxs(ce,{open:z,onClose:()=>f(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(de,{children:n("admin.showtime_management.movie_selection")}),e.jsx(me,{dividers:!0,children:e.jsx(fe,{onMovieSelect:q,selectedMovieId:l})}),e.jsx(he,{children:e.jsx(c,{onClick:()=>f(!1),children:n("admin.showtime_management.close")})})]})]}):e.jsxs(y,{disableCustomTheme:g,children:[e.jsx(w,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{}),e.jsxs(s,{component:"main",sx:a=>({flexGrow:1,backgroundColor:C(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:[e.jsx(i,{color:"error",variant:"h6",children:"No data found for this showtime"}),e.jsx(c,{variant:"contained",onClick:v,sx:{mt:2},children:n("admin.showtime_management.come_back")})]})]})]})]})};export{ke as default};
