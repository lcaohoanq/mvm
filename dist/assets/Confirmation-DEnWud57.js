import{a6 as X,u as Y,a as Z,g as J,r as d,a5 as Q,V as C,j as e,Z as _,_ as S,B as n,$ as w,a0 as T,O as ee,T as s,a1 as te,a2 as se,a3 as ne,x as u,G as m,a9 as B,b as I}from"./index-BUPix-ev.js";import{C as ie}from"./CheckCircleOutline-C1vm2Mpl.js";import{H as oe}from"./Home-BwYC-xrW.js";import{A as re}from"./ArrowBack-CMrICY27.js";import{A as N}from"./Alert-R87I6AkX.js";import{C as ae}from"./CancelOutlined-DP8SD16w.js";const ue=()=>{const A=X(),p=Y(),{t}=Z(),{userDetails:j}=J(),[G,R]=d.useState("success"),{connection:g,joinGroup:f,leaveGroup:y,isConnected:c}=Q(),[b,E]=d.useState(!1),[v]=d.useState(!1),{selectedTime:V="Not selected",selectedDate:H="Not selected",tickets:k=[],seats:P=[],showTimeId:W="",selectedSeatsInfo:h=[],movieData:i=null,roomName:q="",totalPrice:z=0,selectedUser:l=null,paymentMethod:L="money"}=A.state||{},O=(i==null?void 0:i.movieName)||t("payment.movie.default"),U=H,$=V,r=W||"",M=()=>{p("/admin/ql-ban-ve")},D=()=>{p("/admin/dashboard")},[F,K]=d.useState(c);return d.useEffect(()=>{K(c)},[c]),d.useEffect(()=>{if(!c||!r||!g){console.log("Waiting for SignalR connection or missing showTimeId...");return}const a=j==null?void 0:j.userId;return f(r).then(()=>{if(console.log(`Admin confirmation joined ShowTime group: ${r}`),!b&&(h==null?void 0:h.length)>0){const o=h.map(x=>({TicketId:x.ticketId,Version:x.version}));console.log("Confirming seat purchase:",o),g.invoke("ConfirmSeatPurchase",o,r,a).then(()=>{console.log("Seats marked as purchased:",o),E(!0),C.success(t("toast.success.seat.booking"))}).catch(x=>{console.error("Error finalizing seat purchase:",x),C.error(t("toast.error.seat.update_status")+x.message),R("failure")})}}).catch(o=>console.error("Error joining ShowTime group:",o)),()=>{c&&r&&y(r).then(()=>console.log(`Admin confirmation left ShowTime group: ${r}`)).catch(o=>console.error("Error leaving ShowTime group:",o))}},[c,r,g,h,b,f,y]),F?e.jsxs(_,{disableCustomTheme:v,children:[e.jsx(S,{enableColorScheme:!0}),e.jsxs(n,{sx:{display:"flex",height:"100vh"},children:[e.jsx(w,{}),e.jsxs(n,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(T,{}),e.jsx(n,{component:"main",sx:a=>({flexGrow:1,backgroundColor:te(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(se,{spacing:3,children:[e.jsx(ne,{}),e.jsxs(u,{elevation:2,sx:{width:"100%",borderRadius:2,overflow:"hidden"},children:[e.jsx(n,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(s,{variant:"h5",fontWeight:"bold",children:"Xác Nhận Đặt Vé"})}),G==="success"?e.jsxs(N,{severity:"success",icon:e.jsx(ie,{fontSize:"inherit"}),sx:{mx:3,mt:3},children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:t("admin.ticket_management.booking_success")}),e.jsx(s,{variant:"body2",children:t("admin.ticket_management.save_to_system")})]}):e.jsxs(N,{severity:"error",icon:e.jsx(ae,{fontSize:"inherit"}),sx:{mx:3,mt:3},children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:t("admin.ticket_management.booking_faild")}),e.jsx(s,{variant:"body2",children:t("admin.ticket_management.error")})]}),e.jsx(n,{sx:{p:3},children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,md:4,children:e.jsxs(u,{elevation:1,sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(n,{component:"img",src:i==null?void 0:i.image,alt:(i==null?void 0:i.movieName)||t("payment.movie.poster"),sx:{width:"100%",borderRadius:2,objectFit:"contain",maxHeight:400,mb:2}}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:O}),e.jsx(B,{sx:{my:2}}),e.jsxs(n,{sx:{mt:2},children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("payment.movie.room")})," ",q]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("payment.showtime.day")})," ",U]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("payment.showtime.hour")})," ",$]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("payment.ticket.seat")})," ",P.join(", ")||"Chưa chọn ghế"]})]})]})}),e.jsxs(m,{item:!0,xs:12,md:8,children:[l&&e.jsxs(u,{elevation:1,sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Thông Tin Khách Hàng"}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsxs(m,{item:!0,xs:12,sm:6,children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("payment.user_infor")})," ",l.userName]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("auth.signup.fields.email")})," ",l.email]})]}),e.jsxs(m,{item:!0,xs:12,sm:6,children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("auth.signup.fields.id_card")})," ",l.idCard]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:t("auth.signup.fields.phone")})," ",l.phoneNumber]})]})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:t("admin.ticket_management.current_point")})," ",l.point]}),e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:t("admin.ticket_management.payment_method")})," ",L==="money"?"Tiền mặt":"Sử dụng điểm"]})]})]}),e.jsxs(u,{elevation:1,sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:t("admin.ticket_management.payment_detail")}),k.length>0&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:t("admin.ticket_management.ticket_bought")}),k.map((a,o)=>e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{children:[a.name," x",a.quantity]}),e.jsxs(s,{children:[(a.price*a.quantity).toLocaleString("vi-VN"),"đ"]})]},o))]}),e.jsx(B,{sx:{my:2}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{variant:"h6",children:t("admin.ticket_management.amount")}),e.jsxs(s,{variant:"h6",color:"primary",fontWeight:"bold",children:[z.toLocaleString("vi-VN"),"đ"]})]})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(I,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:M,children:t("admin.ticket_management.back")}),e.jsx(I,{variant:"contained",startIcon:e.jsx(oe,{}),onClick:D,children:t("admin.ticket_management.come_to_dashboard")})]})]})]})})]})]})})]})]})]}):e.jsxs(_,{disableCustomTheme:v,children:[e.jsx(S,{enableColorScheme:!0}),e.jsxs(n,{sx:{display:"flex",height:"100vh"},children:[e.jsx(w,{}),e.jsxs(n,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(T,{}),e.jsxs(n,{component:"main",sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(ee,{color:"primary"}),e.jsx(s,{sx:{ml:2},children:t("admin.ticket_management.connecting")})]})]})]})]})};export{ue as default};
