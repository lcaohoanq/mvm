import{u as Ae,a7 as Pe,aJ as Qe,r as s,j as e,C as rt,B as d,T as g,b as o,a5 as G,x as nt,G as ke,a2 as it,ao as oe,aj as z,ak as F,al as B,F as Le,I as we,S as We,f as O,am as X,O as K,l as J,m as ot,V as r,e as v,L as lt,aK as ct,aL as Ee}from"./index-BZsQtJZU.js";import{u as Re}from"./useQuery-CJQUG6ra.js";import{M as Ne}from"./ManagementPageLayout-DPRmNrdR.js";import{E as b}from"./EventSeat-DObcwZhr.js";import{T as ht}from"./TheaterComedy-X66ip1MA.js";import{C as dt,a as ut}from"./ChiTietPhongChieu-Ddx0nsLZ.js";import{T as le}from"./Theaters-BkuzRyK8.js";import{A as j}from"./Alert-BFXvakTO.js";import xt from"./CreateRoom-Two_A2GP.js";import"./ArrowBack-BV7gCk2c.js";import"./CheckCircleOutline-DssXacBJ.js";import"./Info-CBSr26Lv.js";import"./Tabs-BmrH1Jz0.js";import"./Snackbar-DrrhsId5.js";const gt=({rooms:l,onEdit:ce,onRefreshData:c})=>{var Ie,De;const y=Ae(),p=Pe(),h=Qe(),[Y,D]=s.useState(!1),[k,L]=s.useState(!1),[w,u]=s.useState(!1),[f,C]=s.useState(""),[m,he]=s.useState(""),[T,de]=s.useState(!1),[W,ue]=s.useState(!1),[E,xe]=s.useState(!1),[Ve,U]=s.useState(!1),[Me,Z]=s.useState(!1),[$e,_]=s.useState(!1),[ge,N]=s.useState(null),[pe,A]=s.useState(null),[me,P]=s.useState(null),[Q,fe]=s.useState(""),[R,je]=s.useState("HCM"),[V,ye]=s.useState(""),[He,qe]=s.useState(""),[Ge,ee]=s.useState(!1),[M,Ce]=s.useState(!1),[ze,te]=s.useState(!1),[be,$]=s.useState(null),[H,se]=s.useState(""),[q,ae]=s.useState(""),Fe=()=>{y("/admin/ql-phong-chieu/them-phong-chieu")};s.useEffect(()=>{p.state&&p.state.refresh&&(h.invalidateQueries("rooms"),c&&c(),y(p.pathname,{replace:!0}))},[p,h,y,c]);const Be=async()=>(await v.get("seattype")).data.data||[],{data:n,isLoading:Oe}=Re("seatTypes",Be);s.useEffect(()=>{n&&n.length>0&&!m&&he(n[0].seatTypeId)},[n,m]);const Xe=t=>{console.log("Handling click for roomId:",t),console.log("Available rooms:",l),t?y(`/admin/ql-phong-chieu/${t}`):console.error("No roomId provided")},ve=t=>{C(t),D(!0)},Ke=t=>{he(t.target.value)},re=()=>{D(!1),U(!1),N(null)},Je=async()=>{var t,i;if(!f||!m){r.error("Vui lòng chọn loại ghế");return}de(!0),U(!1),N(null);try{const a=await v.post(`seat/room/${f}?seatTypeId=${m}`,{headers:{accept:"text/plain"}});a.data.isSuccess?(U(!0),r.success("Đã tạo ghế thành công!"),setTimeout(()=>{re(),h.invalidateQueries("rooms"),h.invalidateQueries(["roomDetail",f]),c&&c()},1500)):(N(a.data.message||"Tạo ghế không thành công"),r.error(`Lỗi: ${a.data.message}`))}catch(a){const x=((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã xảy ra lỗi khi tạo ghế";N(x),r.error(`Lỗi: ${x}`)}finally{de(!1)}},Te=()=>{if(!n||!m)return"";const t=n==null?void 0:n.find(i=>i.seatTypeId===m);return t?t.typeName:""},Ye=()=>{if(!n||!m)return 0;const t=n==null?void 0:n.find(i=>i.seatTypeId===m);return t?t.price:0},Ue=t=>{C(t),L(!0)},ne=()=>{L(!1),Z(!1),A(null)},Ze=async()=>{var t,i;if(!f){r.error("Không tìm thấy mã phòng");return}ue(!0),Z(!1),A(null);try{const a=await v.delete(`seat/room/${f}`,{headers:{accept:"text/plain"}});a.data.isSuccess?(Z(!0),r.success("Đã xóa tất cả ghế thành công!"),setTimeout(()=>{ne(),h.invalidateQueries("rooms"),h.invalidateQueries(["roomDetail",f]),c&&c()},1500)):(A(a.data.message||"Xóa ghế không thành công"),r.error(`Lỗi: ${a.data.message}`))}catch(a){const x=((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã xảy ra lỗi khi xóa ghế";A(x),r.error(`Lỗi: ${x}`)}finally{ue(!1)}},_e=()=>{u(!0)},ie=()=>{u(!1),_(!1),P(null),fe(""),je("HCM"),ye(""),qe("")},et=t=>{je(t.target.value)},tt=async()=>{var t,i;if(!Q||!R||!V){r.error("Vui lòng điền đầy đủ thông tin");return}xe(!0),_(!1),P(null);try{const a=await v.post("movietheater",{name:Q,location:R,address:V,image:He,isDeleted:!1},{headers:{accept:"text/plain","Content-Type":"application/json-patch+json"}});a.data.isSuccess?(_(!0),r.success("Đã tạo rạp chiếu phim thành công!"),setTimeout(()=>{ie(),h.invalidateQueries("theaters"),h.invalidateQueries("movieTheaters"),h.invalidateQueries("rooms"),c&&c()},1500)):(P(a.data.message||"Tạo rạp chiếu phim không thành công"),r.error(`Lỗi: ${a.data.message}`))}catch(a){const x=((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã xảy ra lỗi khi tạo rạp chiếu phim";P(x),r.error(`Lỗi: ${x}`)}finally{xe(!1)}},st=()=>{ee(!0),te(!1),$(null),se(""),ae("")},Se=()=>{ee(!1)},at=async()=>{var i,a,x;if(!H||!q){r.error("Vui lòng điền đầy đủ thông tin loại ghế");return}const t=parseFloat(q);if(isNaN(t)||t<=0){r.error("Giá ghế phải là số dương");return}Ce(!0),te(!1),$(null);try{const S=await v.post("seattype",{typeName:H,price:t},{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(S.data&&S.data.isSuccess)te(!0),r.success("Đã tạo loại ghế mới thành công!"),se(""),ae(""),setTimeout(()=>{h.invalidateQueries("seatTypes"),ee(!1)},1500);else{const I=((i=S.data)==null?void 0:i.message)||"Không thể tạo loại ghế mới";$(I),r.error(`Lỗi: ${I}`)}}catch(S){const I=((x=(a=S.response)==null?void 0:a.data)==null?void 0:x.message)||"Đã xảy ra lỗi khi tạo loại ghế mới";$(I),r.error(`Lỗi: ${I}`)}finally{Ce(!1)}};return e.jsxs(rt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ht,{sx:{fontSize:32,color:"primary.main",mr:2}}),e.jsx(g,{variant:"h4",fontWeight:"bold",children:"Danh sách phòng chiếu"})]}),e.jsxs(d,{sx:{display:"flex",gap:2},children:[e.jsx(o,{variant:"outlined",color:"info",startIcon:e.jsx(b,{}),onClick:st,children:"Tạo loại ghế mới"}),e.jsx(o,{variant:"outlined",color:"secondary",startIcon:e.jsx(le,{}),onClick:_e,children:"Tạo rạp chiếu phim"}),e.jsx(o,{variant:"contained",color:"primary",startIcon:e.jsx(G,{}),onClick:Fe,children:"Tạo phòng chiếu mới"})]})]}),e.jsx(nt,{elevation:0,sx:{borderRadius:2,bgcolor:"#f8f9fa",p:3},children:e.jsx(ke,{container:!0,spacing:3,children:l.map(t=>e.jsx(ke,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(it,{elevation:3,sx:{borderRadius:3,overflow:"hidden",transition:"all 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 12px 20px rgba(0,0,0,0.15)"},height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(d,{sx:{bgcolor:"primary.main",color:"white",py:2,px:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(dt,{sx:{mr:1}}),e.jsx(g,{variant:"h6",fontWeight:"bold",children:t.roomName})]})}),e.jsxs(d,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(b,{sx:{color:"primary.main",fontSize:50,mr:1.5}}),e.jsx(g,{variant:"h3",fontWeight:"medium",children:t.total}),e.jsx(g,{variant:"body1",color:"text.secondary",sx:{ml:1,alignSelf:"flex-end",mb:1},children:"ghế"})]}),e.jsxs(d,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.jsx(o,{variant:"outlined",color:"primary",fullWidth:!0,onClick:()=>Xe(t.roomId),sx:{borderRadius:2,py:1},children:"Xem chi tiết"}),t.total===0?e.jsx(o,{variant:"contained",color:"secondary",fullWidth:!0,onClick:()=>ve(t.roomId),sx:{borderRadius:2,py:1},startIcon:e.jsx(G,{}),children:"Tạo ghế"}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outlined",color:"secondary",fullWidth:!0,onClick:()=>ve(t.roomId),sx:{borderRadius:2,py:1},startIcon:e.jsx(G,{}),children:"Tạo thêm ghế"}),e.jsx(o,{variant:"outlined",color:"error",fullWidth:!0,onClick:()=>Ue(t.roomId),sx:{borderRadius:2,py:1},startIcon:e.jsx(oe,{}),children:"Xóa tất cả ghế"})]})]})]})]})},t.roomId))})}),e.jsxs(z,{open:Y,onClose:re,fullWidth:!0,maxWidth:"xs",children:[e.jsxs(F,{sx:{bgcolor:"primary.main",color:"white",pb:2},children:[e.jsx(b,{sx:{mr:1,verticalAlign:"middle"}}),((Ie=l.find(t=>t.roomId===f))==null?void 0:Ie.total)===0?"Tạo ghế cho phòng":"Tạo thêm ghế cho phòng"]}),e.jsxs(B,{sx:{pt:3,pb:2},children:[e.jsx(g,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:((De=l.find(t=>t.roomId===f))==null?void 0:De.total)===0?"Chọn loại ghế để tạo cho phòng chiếu. Tất cả ghế trong phòng sẽ được tạo với loại ghế này.":"Tạo thêm ghế cho phòng chiếu hiện có. Ghế mới sẽ được thêm vào với loại ghế được chọn."}),e.jsxs(Le,{fullWidth:!0,sx:{mt:1,mb:2},children:[e.jsx(we,{children:"Loại ghế"}),e.jsx(We,{value:m,onChange:Ke,label:"Loại ghế",disabled:Oe||T,children:n==null?void 0:n.map(t=>e.jsxs(O,{value:t.seatTypeId,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{color:"action",fontSize:"small"}),e.jsx("span",{children:t.typeName}),e.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.85rem",color:"#666"},children:[t.price.toLocaleString("vi-VN"),"đ"]})]},t.seatTypeId))})]}),Te()&&e.jsxs(d,{sx:{p:2,bgcolor:"#f5f5f5",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(g,{variant:"body2",children:["Đã chọn: ",e.jsx("strong",{children:Te()})]}),e.jsxs(g,{variant:"body2",color:"primary",fontWeight:"medium",children:[Ye().toLocaleString("vi-VN"),"đ"]})]}),Ve&&e.jsx(j,{severity:"success",sx:{mb:2},children:"Tạo ghế thành công!"}),ge&&e.jsx(j,{severity:"error",sx:{mb:2},children:ge})]}),e.jsxs(X,{sx:{px:3,pb:3},children:[e.jsx(o,{onClick:re,disabled:T,variant:"outlined",children:"Hủy"}),e.jsx(o,{onClick:Je,variant:"contained",disabled:T||!m,startIcon:T?e.jsx(K,{size:20}):e.jsx(G,{}),children:T?"Đang tạo...":"Tạo ghế"})]})]}),e.jsxs(z,{open:k,onClose:ne,fullWidth:!0,maxWidth:"xs",children:[e.jsxs(F,{sx:{bgcolor:"error.main",color:"white",pb:2},children:[e.jsx(oe,{sx:{mr:1,verticalAlign:"middle"}}),"Xóa tất cả ghế"]}),e.jsxs(B,{sx:{pt:3,pb:2},children:[e.jsx(g,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:"Bạn có chắc chắn muốn xóa tất cả ghế trong phòng này? Hành động này không thể hoàn tác."}),e.jsx(d,{sx:{p:2,bgcolor:"#fff8e1",borderRadius:1,border:"1px solid #ffe57f",mb:2},children:e.jsxs(g,{variant:"body2",color:"warning.dark",children:[e.jsx("strong",{children:"Lưu ý:"})," Việc xóa tất cả ghế sẽ ảnh hưởng đến các lịch chiếu nếu có. Hãy chắc chắn rằng phòng này không còn được sử dụng cho bất kỳ lịch chiếu nào."]})}),Me&&e.jsx(j,{severity:"success",sx:{mb:2},children:"Xóa ghế thành công!"}),pe&&e.jsx(j,{severity:"error",sx:{mb:2},children:pe})]}),e.jsxs(X,{sx:{px:3,pb:3},children:[e.jsx(o,{onClick:ne,disabled:W,variant:"outlined",children:"Hủy"}),e.jsx(o,{onClick:Ze,variant:"contained",color:"error",disabled:W,startIcon:W?e.jsx(K,{size:20,color:"inherit"}):e.jsx(oe,{}),children:W?"Đang xóa...":"Xác nhận xóa"})]})]}),e.jsxs(z,{open:w,onClose:ie,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(F,{sx:{bgcolor:"secondary.main",color:"white",pb:2},children:[e.jsx(le,{sx:{mr:1,verticalAlign:"middle"}}),"Tạo rạp chiếu phim mới"]}),e.jsxs(B,{sx:{pt:3,pb:2},children:[e.jsx(g,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Vui lòng nhập thông tin cho rạp chiếu phim mới"}),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(J,{fullWidth:!0,label:"Tên rạp chiếu phim",value:Q,onChange:t=>fe(t.target.value),required:!0}),e.jsxs(Le,{fullWidth:!0,required:!0,children:[e.jsx(we,{children:"Địa điểm"}),e.jsxs(We,{value:R,onChange:et,label:"Địa điểm",children:[e.jsx(O,{value:"HCM",children:"HCM"}),e.jsx(O,{value:"BD",children:"BD"}),e.jsx(O,{value:"Củ Chi",children:"Củ Chi"})]})]}),e.jsx(J,{fullWidth:!0,label:"Địa chỉ chi tiết",value:V,onChange:t=>ye(t.target.value),required:!0,multiline:!0,rows:2})]}),$e&&e.jsx(j,{severity:"success",sx:{mt:2,mb:1},children:"Tạo rạp chiếu phim thành công!"}),me&&e.jsx(j,{severity:"error",sx:{mt:2,mb:1},children:me})]}),e.jsxs(X,{sx:{px:3,pb:3},children:[e.jsx(o,{onClick:ie,disabled:E,variant:"outlined",children:"Hủy"}),e.jsx(o,{onClick:tt,variant:"contained",color:"secondary",disabled:E||!Q||!R||!V,startIcon:E?e.jsx(K,{size:20}):e.jsx(le,{}),children:E?"Đang tạo...":"Tạo rạp chiếu phim"})]})]}),e.jsxs(z,{open:Ge,onClose:Se,fullWidth:!0,maxWidth:"xs",children:[e.jsxs(F,{sx:{bgcolor:"info.main",color:"white",pb:2},children:[e.jsx(b,{sx:{mr:1,verticalAlign:"middle"}}),"Tạo loại ghế mới"]}),e.jsxs(B,{sx:{pt:3,pb:2},children:[e.jsx(g,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Vui lòng nhập thông tin cho loại ghế mới"}),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(J,{fullWidth:!0,label:"Tên loại ghế",value:H,onChange:t=>se(t.target.value),required:!0,placeholder:"VD: Ghế VIP, Ghế đôi, Ghế thường..."}),e.jsx(J,{fullWidth:!0,label:"Giá ghế",type:"number",value:q,onChange:t=>ae(t.target.value),required:!0,placeholder:"VD: 100000",InputProps:{endAdornment:e.jsx(ot,{position:"end",children:"VND"})}})]}),ze&&e.jsx(j,{severity:"success",sx:{mt:2,mb:1},children:"Tạo loại ghế mới thành công!"}),be&&e.jsx(j,{severity:"error",sx:{mt:2,mb:1},children:be})]}),e.jsxs(X,{sx:{px:3,pb:3},children:[e.jsx(o,{onClick:Se,disabled:M,variant:"outlined",children:"Hủy"}),e.jsx(o,{onClick:at,variant:"contained",color:"info",disabled:M||!H||!q,startIcon:M?e.jsx(K,{size:20}):e.jsx(b,{}),children:M?"Đang tạo...":"Tạo loại ghế"})]})]})]})},wt=()=>{const l=Pe(),ce=Ae(),c=Qe(),y=l.pathname.split("/").length>3,p=!y,h=async()=>{try{const u=await v.get("room");return console.log("API Response:",u.data),(u.data.data||[]).map(C=>({roomId:C.roomId,roomName:C.roomName,total:C.total}))}catch(u){throw console.error("Error fetching rooms:",u),u}},{data:Y=[],isLoading:D,error:k,refetch:L}=Re("PhongChieuData",h,{enabled:p}),w=()=>{p&&(c.invalidateQueries("PhongChieuData"),c.invalidateQueries("rooms"),L())};return s.useEffect(()=>{(l.state&&l.state.refresh||l.pathname.endsWith("/ql-phong-chieu")&&l.key)&&p&&(console.log("Auto refreshing room data..."),w(),l.state&&l.state.refresh&&ce(l.pathname,{replace:!0,state:{}}))},[l,p]),D&&p?e.jsx(lt,{}):k?e.jsx(Ne,{children:e.jsxs("div",{children:["Error: ",k.message]})}):e.jsx(e.Fragment,{children:y?e.jsxs(ct,{children:[e.jsx(Ee,{path:"/:id",element:e.jsx(ut,{})}),e.jsx(Ee,{path:"/them-phong-chieu",element:e.jsx(xt,{})})]}):e.jsx(Ne,{children:e.jsx(gt,{rooms:Y,onEdit:u=>console.log("Edit room:",u),onRefreshData:w})})})};export{wt as default};
