import{a0 as ne,r as s,a as V,j as e,L as xe,B as l,G as M,x as D,T as c,d as H,e as Y,a1 as he,F as ue,S as me,f as $,a2 as oe,a3 as ie,b as ce,a4 as pe,h as X,a5 as fe,V as L,u as ge,U as Z,W as O,X as Q,Y as ee,Z as R,_ as te,$ as se}from"./index-C374tz6i.js";import{A as be}from"./AccessTime-VpTxmUYN.js";import{a as ae,v as ye,T as je,b as ve,R as Ce}from"./vi-Cf4VS8JZ.js";import{f as T}from"./format-csk1fyom.js";import{S as we,P as Se,a as ke}from"./pagination-DCEJlY0H.js";/* empty css                   */const Te=({onMovieLoad:p})=>{const{movieId:h}=ne(),[t,f]=s.useState(),[u,m]=s.useState(!0),{t:j}=V(),y=async()=>{try{m(!0);const i=await Y.get(`movie/${h}`);f(i.data.data),p&&p(i.data.data),console.log("Movie detail:",i.data.data)}catch(i){console.error("Failed to fetch movie:",i)}finally{console.log(h+"haha"),m(!1)}};s.useEffect(()=>{y()},[j]);const C=i=>{if(!i)return"N/A";const w={day:"2-digit",month:"2-digit",year:"numeric"};return new Date(i).toLocaleDateString("vi-VN",w)};return u?e.jsx(xe,{}):e.jsx(l,{sx:{bgcolor:"background.paper",color:"text.primary"},children:e.jsxs(M,{container:!0,spacing:4,sx:{alignItems:"stretch"},children:[e.jsx(M,{item:!0,xs:12,md:4,children:e.jsx(D,{elevation:2,sx:{p:1,height:"100%"},children:e.jsx(l,{component:"img",src:t==null?void 0:t.image,alt:t==null?void 0:t.movieName,sx:{width:"100%",height:"100%",borderRadius:1,objectFit:"contain"}})})}),e.jsxs(M,{item:!0,xs:12,md:8,sx:{display:"flex",flexDirection:"column"},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",mb:2,children:t==null?void 0:t.movieName}),e.jsxs(l,{sx:{mb:3},children:[e.jsx(H,{label:t==null?void 0:t.rating,color:"error",sx:{mb:1,mr:1}}),e.jsx(H,{icon:e.jsx(be,{}),label:`${t==null?void 0:t.duration}'`,sx:{mr:1,mb:1},color:"default"}),e.jsx(H,{label:t==null?void 0:t.categories.map(i=>i.name).join(", "),sx:{mr:1,mb:1,backgroundColor:"red",color:"white"}})]}),e.jsx(c,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"MÔ TẢ"}),e.jsxs(l,{sx:{mb:3,textAlign:"justify",flexGrow:1},children:[e.jsxs(c,{mb:1,variant:"body2",children:[e.jsx("strong",{children:"Đạo diễn:"})," ",t==null?void 0:t.director]}),e.jsxs(c,{mb:1,variant:"body2",sx:{textAlign:"left"},children:[e.jsx("strong",{children:"Diễn viên:"})," ",t==null?void 0:t.actors]}),e.jsxs(c,{mb:1,variant:"body2",children:[e.jsx("strong",{children:"Khởi chiếu:"})," ",C(t==null?void 0:t.fromDate)]}),e.jsx(c,{variant:"subtitle1",fontWeight:"bold",mb:1,mt:2,children:"NỘI DUNG PHIM"}),e.jsx(c,{paragraph:!0,variant:"body2",sx:{textAlign:"justify"},children:t==null?void 0:t.content})]})]})]})})},q=new Map,De=({movieId:p,onRoomSelect:h,onSelectDate:t,onSelectTime:f,onShowtimeAvailability:u})=>{const m=new Date,j=T(m,"dd/MM"),[y,C]=s.useState(j),[i,w]=s.useState("hcm"),[S,a]=s.useState(null),[o,d]=s.useState([]),[W,I]=s.useState(!1),{t:g,i18n:A}=V(),N=s.useRef(null),r=s.useMemo(()=>Array.from({length:4},(n,x)=>{const b=ae(m,x),_=T(b,"EEEE",{locale:A.language==="vi"?ye:void 0});return{date:b,formatted:T(b,"dd/MM"),label:g(`${_.toLowerCase()}`)}}),[m,g,A.language]),z=s.useCallback((n,x)=>{x&&(C(x),t(x),a(null))},[t]),F=n=>q.get(n);s.useEffect(()=>{t(j)},[t,j]);const G=s.useCallback((n,x)=>{a({time:n,id:x}),f(n),h(x),sessionStorage.setItem("currentShowTimeId",x)},[f,h]);return s.useEffect(()=>{const n=r.find(P=>P.formatted===y);if(!n)return;const x=T(n.date,"yyyy-MM-dd"),b=T(ae(n.date,3),"yyyy-MM-dd"),_=T(n.date,"yyyy-MM-dd"),B=`${p}_${x}_${i}`;let E=!0;const le=async()=>{const P=F(B);if(P){E&&(d(P),I(!1),u(P.length>0));return}I(!0);try{const J=await Y.get(`showtime/${p}/from/${x}/to/${b}/locate/${i.toUpperCase()}`);if(!E)return;const k=J.data.data[_];if(!k||!k[i.toUpperCase()]||k[i.toUpperCase()].length===0){const v=[];d(v),q.set(B,v),u(!1);return}const U=k[i.toUpperCase()].map(v=>({name:v.nameTheater,address:v.addressTheater,times:v.listShowTime.map(K=>({time:T(new Date(K.startTime),"HH:mm"),showTimeId:K.showTimeId}))})).filter(v=>v.name&&v.times&&v.times.length>0);d(U),q.set(B,U),u(U.length>0)}catch{const k=[];d(k),q.set(B,k),u(!1)}finally{E&&I(!1)}},de=setTimeout(()=>{le()},300);return()=>{E=!1,clearTimeout(de)}},[i,y,r,p,u]),s.useEffect(()=>{const n=o.length>0;N.current!==n&&(N.current=n,u(n))},[o.length,u]),e.jsx(l,{sx:{bgcolor:"background.paper",color:"text.primary",py:3},children:e.jsxs(l,{maxWidth:"md",sx:{mx:"auto"},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",textAlign:"center",mb:3,children:g("showtime_cinema.title.showtime_list")}),e.jsx(je,{value:y,exclusive:!0,onChange:z,sx:{display:"flex",justifyContent:"center",gap:2,mb:3,flexWrap:"wrap"},children:r.map((n,x)=>{const b=n.formatted===j;return e.jsxs(ve,{value:n.formatted,sx:{border:"1px solid",borderColor:"primary.main",color:"primary.main","&.Mui-selected":{backgroundColor:"primary.main",color:"white",fontWeight:"bold"},"&.Mui-selected:hover":{backgroundColor:"primary.dark"},borderRadius:"8px",px:3,py:1.5,minWidth:"90px",position:"relative"},children:[b&&e.jsx(c,{variant:"caption",sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",backgroundColor:"error.main",color:"white",borderRadius:"4px",px:.5,fontWeight:"bold",whiteSpace:"nowrap"},children:g("showtime_cinema.title.now_day")}),e.jsxs(l,{textAlign:"center",children:[e.jsx(c,{variant:"h6",fontWeight:"bold",mb:1,children:n.formatted}),e.jsx(c,{variant:"body2",children:n.label})]})]},x)})}),e.jsxs(M,{container:!0,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(M,{item:!0,children:e.jsxs(c,{variant:"h6",fontWeight:"bold",children:["🎬 ",g("showtime_cinema.title.theater_list")]})}),e.jsx(M,{item:!0,children:e.jsx(ue,{size:"small",children:e.jsxs(me,{value:i,onChange:n=>w(n.target.value),sx:{borderRadius:"8px",minWidth:"120px"},children:[e.jsx($,{value:"hcm",children:g("showtime_cinema.location.HCM")}),e.jsx($,{value:"hn",children:g("showtime_cinema.location.HaNoi")}),e.jsx($,{value:"bd",children:g("showtime_cinema.location.BinhDuong")}),e.jsx($,{value:"bp",children:g("showtime_cinema.location.BinhPhuoc")})]})})})]}),!W&&e.jsx(l,{sx:{borderRadius:"12px"},children:o.length>0?o.map((n,x)=>e.jsx(oe,{sx:{borderRadius:"8px",p:2,mb:2,boxShadow:2},children:e.jsxs(ie,{children:[e.jsx(c,{variant:"h6",fontWeight:"bold",color:"primary",mb:1,children:n.name}),e.jsx(c,{variant:"body2",mb:2,color:"text.secondary",children:n.address}),e.jsx(l,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:n.times.map((b,_)=>e.jsx(ce,{variant:(S==null?void 0:S.time)===b.time?"contained":"outlined",size:"small",sx:{fontWeight:"bold",minWidth:"70px"},onClick:()=>G(b.time,b.showTimeId),children:b.time},_))})]})},x)):e.jsx(c,{variant:"body1",textAlign:"center",sx:{py:5,color:"text.secondary"},children:g("showtime_cinema.title.no_showtime")})})]})})},Me=he.memo(De),re={en:{locale:"en-US",currency:"USD"},jp:{locale:"ja-JP",currency:"JPY"},vi:{locale:"vi-VN",currency:"VND"}},We={VND:1,USD:39e-6,JPY:.0058},Ie=({onNext:p})=>{const[h,t]=s.useState([]),{t:f,i18n:u}=V();pe();const[m,j]=s.useState({locale:"vi-VN",currency:"VND"});s.useEffect(()=>{const o=u.language.substring(0,2);j(re[o]||re.vi)},[u.language]),s.useEffect(()=>{(async()=>{try{const d=(await Y.get("seattype")).data.data.map(W=>({...W,quantity:0}));t(d)}catch(o){console.error("Error fetching seat types:",o),L.error(f("errors.fetch_seats_failed"))}})()},[f]);const y=a=>{t(o=>o.map(d=>d.seatTypeId===a?{...d,quantity:d.quantity+1}:d))},C=a=>{t(o=>o.map(d=>d.seatTypeId===a&&d.quantity>0?{...d,quantity:d.quantity-1}:d))},i=(a,o)=>o==="VND"?a:a*We[o],w=a=>{const o=i(a,m.currency);return(m.currency==="JPY"?Math.round(o):o).toLocaleString(m.locale,{style:"currency",currency:m.currency})},S=()=>{const a=h.filter(o=>o.quantity>0);if(a.length===0){L.error(f("toast.error.ticket.selection"));return}p&&p(a)};return e.jsxs(l,{sx:{padding:{xs:2,sm:3},textAlign:"center"},children:[e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",mb:4,color:"text.primary"},children:f("ticket_price.ticket_selection")}),e.jsx(l,{sx:{width:"100%",maxWidth:"900px",margin:"0 auto",overflow:"hidden",position:"relative"},children:e.jsx(we,{slidesPerView:1,spaceBetween:20,pagination:{clickable:!0},breakpoints:{600:{slidesPerView:2},900:{slidesPerView:3}},autoplay:{delay:1e3},loop:h.length>4,modules:[Se],style:{width:"100%",margin:"0 auto",paddingBottom:"30px"},children:h.map(a=>e.jsx(ke,{children:e.jsx(oe,{elevation:2,sx:{borderRadius:2,textAlign:"center",p:2,height:"100%",transition:"transform 0.2s ease","&:hover":{transform:"translateY(-4px)"},boxShadow:2},children:e.jsxs(ie,{children:[e.jsx(c,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:a.typeName}),e.jsx(c,{variant:"body1",sx:{color:"primary.main",fontWeight:"bold",mb:2},children:w(a.price)}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mt:2},children:[e.jsx(X,{onClick:()=>C(a.seatTypeId),color:"primary",disabled:a.quantity===0,size:"small",children:e.jsx(Ce,{})}),e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",mx:2,minWidth:"30px"},children:a.quantity}),e.jsx(X,{onClick:()=>y(a.seatTypeId),color:"primary",size:"small",children:e.jsx(fe,{})})]})]})})},a.seatTypeId))})}),p&&e.jsx(l,{sx:{mt:4},children:e.jsx(ce,{variant:"contained",color:"primary",sx:{fontWeight:"bold",px:4,py:1},onClick:S,children:f("ticket_price.next")})})]})},$e=()=>{const p=ge(),{movieId:h}=ne(),{t}=V(),[f,u]=s.useState(null),[m,j]=s.useState(""),[y,C]=s.useState(null),[i,w]=s.useState(""),[S,a]=s.useState(!1),[o]=s.useState(!1),d=s.useCallback(r=>{w(r)},[]),W=s.useCallback(r=>{j(r)},[]),I=s.useCallback(r=>{C(r)},[]),g=s.useCallback(r=>{a(r)},[]),A=s.useCallback(r=>{u(r)},[]),N=s.useCallback(r=>{if(!y){L.error(t("toast.error.showtime.selection"));return}if(r.reduce((F,G)=>F+(G.quantity||0),0)===0){L.error(t("toast.error.ticket.selection"));return}p("/admin/ql-ban-ve/movie-seat",{state:{movieId:h,showTimeId:i,selectedDate:m,selectedTime:y,tickets:r,movieData:f}})},[h,p,i,m,y,f]);return h?e.jsxs(Z,{disableCustomTheme:o,children:[e.jsx(O,{enableColorScheme:!0}),e.jsxs(l,{sx:{display:"flex",height:"100vh"},children:[e.jsx(Q,{}),e.jsxs(l,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(ee,{}),e.jsx(l,{component:"main",sx:r=>({flexGrow:1,backgroundColor:R(r.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(te,{spacing:3,children:[e.jsx(se,{}),e.jsxs(D,{elevation:2,sx:{width:"100%",borderRadius:2},children:[e.jsx(l,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider",textAlign:"center"},children:e.jsx(c,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:t("menu.breadcrumbs.ticketBooking")})}),e.jsxs(l,{sx:{p:3},children:[e.jsx(D,{elevation:1,sx:r=>({backgroundColor:R(r.palette.background.default,.6),p:3,mb:3}),children:e.jsx(Te,{onMovieLoad:A})}),e.jsx(D,{elevation:1,sx:r=>({backgroundColor:R(r.palette.background.default,.6),p:3,mb:3}),children:e.jsx(Me,{movieId:h,onRoomSelect:d,onSelectDate:W,onSelectTime:I,onShowtimeAvailability:g})}),S&&e.jsx(D,{elevation:1,sx:r=>({backgroundColor:R(r.palette.background.default,.6),p:3}),children:e.jsx(Ie,{onNext:N})})]})]})]})})]})]})]}):e.jsxs(Z,{disableCustomTheme:o,children:[e.jsx(O,{enableColorScheme:!0}),e.jsxs(l,{sx:{display:"flex",height:"100vh"},children:[e.jsx(Q,{}),e.jsxs(l,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(ee,{}),e.jsx(l,{component:"main",sx:r=>({flexGrow:1,backgroundColor:R(r.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(te,{spacing:3,children:[e.jsx(se,{}),e.jsxs(D,{elevation:2,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[e.jsx(c,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:t("oops")}),e.jsx(c,{variant:"h6",sx:{p:4,border:2,borderColor:"error.main",color:"error.main",borderRadius:2,textAlign:"center"},children:t("admin.ticket_management.not_existing")})]})]})})]})]})]})};export{$e as default};
