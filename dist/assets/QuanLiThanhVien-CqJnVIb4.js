import{c as W,j as t,u as B,a as O,a6 as V,r as l,a4 as U,ao as M,V as q,B as m,a8 as Q,d as C,ap as $,x as K,T as j,R as X,ar as Y}from"./index-CmSrV0e4.js";import{k as J,G as Z,C as ee,a as S,P as te}from"./swapy-CG7UBIpH.js";import{u as oe}from"./useQuery-CXK_ViA-.js";import{f as ae,R as ie}from"./user.apis-b3PE4-VX.js";import{M as re}from"./ManagementPageLayout-CDsNXoK3.js";const ne=W(t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle"),se=W(t.jsx("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),ue=()=>{const N=B(),{t:i}=O(),D=V(),c=l.useRef(null),u=l.useRef(null),x=U(),o=M(x.breakpoints.down("sm")),r=M(x.breakpoints.down("md")),f=M(x.breakpoints.down("lg")),[R,_]=l.useState(["members","active","points","newMembers","inactive"]),{data:a,isLoading:z,error:h}=oe({queryKey:["users","members"],queryFn:async()=>{const e=await ae(ie.Member);if(!e.isSuccess||!e.data)throw new Error(e.message||"Failed to fetch members");return e.data}}),p=(a==null?void 0:a.length)||0,y=(a==null?void 0:a.filter(e=>e.status===1).length)||0,A=new Date,k=(a==null?void 0:a.filter(e=>{const n=new Date(e.joinDate);return(A.getTime()-n.getTime())/(1e3*60*60*24)<=30}).length)||0,G=(a==null?void 0:a.filter(e=>e.gender===1).length)||0,T=(a==null?void 0:a.filter(e=>e.gender===2).length)||0,E=p?p-y:0,F=(a==null?void 0:a.reduce((e,n)=>e+(n.point||0),0))||0,s={members:{id:"members",title:i("common.stats.total_members")||"Total Members",value:p,icon:t.jsx(te,{sx:{fontSize:40}}),color:"#4051B5"},active:{id:"active",title:i("common.stats.active_members")||"Active Members",value:y,icon:t.jsx(S,{sx:{fontSize:40}}),color:"#4CAF50"},newMembers:{id:"newMembers",title:i("common.stats.new_members_in30days")||"New Members",value:k,icon:t.jsx(ne,{sx:{fontSize:40}}),color:"#4DA1A9"},maleMembers:{id:"maleMembers",title:i("common.stats.male_members")||"Male Members",value:G,icon:t.jsx(S,{sx:{fontSize:40}}),color:"#4CAF50"},femaleMembers:{id:"femaleMembers",title:i("common.stats.female_members")||"Female Members",value:T,icon:t.jsx(S,{sx:{fontSize:40}}),color:"#4CAF50"},inactive:{id:"inactive",title:i("common.stats.inactive_members")||"Inactive Members",value:E,icon:t.jsx(ee,{sx:{fontSize:40}}),color:"#E50046"},points:{id:"points",title:i("common.stats.total_points")||"Total Points",value:F.toLocaleString(),icon:t.jsx(se,{sx:{fontSize:40}}),color:"#FF9800"}};l.useEffect(()=>{h&&q.error(h instanceof Error?h.message:"Failed to load members")},[h,D]),l.useEffect(()=>{let e;return u.current&&(e=setTimeout(()=>{try{c.current=J(u.current,{animation:"spring",swapMode:"drop",autoScrollOnDrag:!0,enabled:!0,dragAxis:"both",dragOnHold:!1}),c.current.onSwap(n=>{console.log("Swap occurred:",n);const{fromSlot:L,toSlot:P}=n;_(b=>{const d=[...b],g=b.findIndex(v=>v===L),w=b.findIndex(v=>v===P);return g!==-1&&w!==-1&&([d[g],d[w]]=[d[w],d[g]]),d})})}catch(n){console.error("Swapy initialization error:",n)}},100)),()=>{if(clearTimeout(e),c.current)try{c.current.destroy()}catch(n){console.error("Error destroying Swapy:",n)}}},[]);const I=e=>N(`/admin/ql-thanh-vien/${e}`),H=l.useMemo(()=>[{field:"userName",headerName:i("common.table_header.user.username")||"Username",flex:.5,minWidth:90,maxWidth:o?80:120,renderCell:e=>t.jsx(m,{sx:{display:"flex",alignItems:"center"},children:t.jsx(Q,{src:e.row.avatar||"/default-avatar.png",alt:e.row.fullName,sx:{width:o?24:32,height:o?24:32}})})},{field:"fullName",headerName:i("common.table_header.user.fullname")||"Full Name",flex:1,minWidth:120},{field:"email",headerName:i("common.table_header.user.email")||"Email",flex:1,minWidth:150,hide:o},{field:"phoneNumber",headerName:i("common.table_header.user.phone")||"Phone",flex:.8,minWidth:110,hide:r},{field:"idCard",headerName:i("common.table_header.user.id_card")||"Id Card",flex:.8,minWidth:120,hide:f,align:"left",renderCell:e=>e.row.idCard===""?"N/A":e.row.idCard},{field:"gender",headerName:i("common.table_header.user.gender")||"Gender",flex:.5,minWidth:80,maxWidth:100,hide:o,renderCell:e=>t.jsx(C,{label:e.row.gender===0?"Male":"Female",color:e.row.gender===0?"info":"secondary",sx:{fontWeight:"bold",borderRadius:"16px",minWidth:r?"60px":"80px",minHeight:r?"24px":"30px",fontSize:r?"0.7rem":"0.8rem"}})},{field:"status",headerName:i("common.table_header.user.status")||"Status",align:"center",flex:.5,minWidth:80,maxWidth:100,renderCell:e=>t.jsx(C,{label:e.row.status===1?"Active":"Inactive",color:e.row.status===1?"success":"error",sx:{fontWeight:"bold",borderRadius:"16px",minWidth:r?"60px":"80px",minHeight:r?"24px":"30px",fontSize:r?"0.7rem":"0.8rem"}})},{field:"point",headerName:i("common.table_header.user.points")||"Points",flex:.4,minWidth:70,type:"number",align:"center",hide:o},{field:"actions",headerName:i("common.table_header.actions")||"Actions",type:"actions",flex:.4,minWidth:60,getActions:e=>[t.jsx(Z,{icon:t.jsx($,{}),label:"Edit",onClick:()=>I(e.row.userId)})]}],[i,o,r,f]);return t.jsx(re,{children:t.jsxs(m,{sx:{width:"100%",overflow:"hidden",px:{xs:1,sm:2},"& .MuiDataGrid-root":{border:"none",backgroundColor:"white",borderRadius:2,boxShadow:1,"& .MuiDataGrid-columnHeaders":{backgroundColor:"primary.main",color:"black",fontWeight:"bold"},"& .MuiDataGrid-cell":{borderBottom:"1px solid #f0f0f0",whiteSpace:"normal",padding:o?"8px 4px":"8px 16px"},"& .MuiDataGrid-row:hover":{backgroundColor:"#f5f5f5"},"& .MuiDataGrid-columnHeaderTitle":{fontWeight:"bold",fontSize:o?"0.75rem":"0.875rem",whiteSpace:"normal",lineHeight:1.2,overflow:"visible"},"& .MuiDataGrid-cellContent":{fontSize:o?"0.75rem":"0.875rem",overflow:"hidden",textOverflow:"ellipsis"}}},children:[t.jsx("div",{ref:u,className:"swapy-container",style:{marginBottom:"1.5rem",display:"flex",flexWrap:"wrap",gap:"8px",justifyContent:"center"},children:R.map(e=>t.jsx("div",{className:"swapy-slot","data-swapy-slot":e,style:{margin:"4px",flex:o?"1 1 100%":r?"1 1 45%":"1 1 230px",minWidth:o?"100%":"230px",maxWidth:o?"100%":"350px",display:"inline-block"},children:t.jsx("div",{className:"swapy-item","data-swapy-item":e,style:{cursor:"grab"},children:t.jsxs(K,{elevation:3,sx:{p:o?2:3,borderRadius:2,height:"100%",borderLeft:`5px solid ${s[e].color}`,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-5px)",boxShadow:"0 10px 20px rgba(0,0,0,0.15)"}},children:[t.jsxs(m,{children:[t.jsx(j,{variant:o?"subtitle1":"h6",fontWeight:"bold",children:s[e].title}),t.jsx(j,{variant:o?"h5":"h4",fontWeight:"bold",mt:1,children:s[e].value})]}),t.jsx(m,{sx:{backgroundColor:`${s[e].color}20`,p:o?1.5:2,ml:2,borderRadius:"50%",color:s[e].color,display:"flex",alignItems:"center",justifyContent:"center"},children:X.cloneElement(s[e].icon,{sx:{fontSize:o?30:40}})})]})})},e))}),t.jsx(m,{sx:{backgroundColor:"white",borderRadius:2,boxShadow:1,p:{xs:1,sm:2},mb:4,width:"100%",overflow:"hidden"},children:t.jsx(Y,{rows:a||[],columns:H,loading:z,getRowId:e=>e.userId,initialState:{pagination:{paginationModel:{pageSize:o?5:10}},columns:{columnVisibilityModel:{email:!o,phoneNumber:!r,idCard:!f,gender:!o,point:!o}}},pageSizeOptions:o?[5,10]:[5,10,25],disableRowSelectionOnClick:!0,autoHeight:!0,density:r?"compact":"standard",sx:{width:"100%","& .MuiDataGrid-virtualScroller":{overflow:"auto"},"& .MuiDataGrid-main":{width:"100%",overflow:"hidden"},"& .MuiDataGrid-columnHeaders, & .MuiDataGrid-footerContainer":{width:"100% !important"},"& .MuiDataGrid-virtualScrollerContent":{width:"100% !important"}}})})]})})};export{ue as default};
