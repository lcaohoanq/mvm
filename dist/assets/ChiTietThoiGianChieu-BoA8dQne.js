import{c as K,j as e,W as X,u as ee,r as i,L as ae,Z as y,_ as w,B as s,$ as S,a0 as I,a1 as C,T as r,b as c,ak as n,a2 as te,a3 as se,C as oe,l as W,F as ne,S as ie,f as $,aF as re,aG as le,aC as H,ai as ce,aj as de,al as me,am as he,e as p}from"./index-B_QWfTc0.js";import{u as b}from"./useQuery-BJpiDE26.js";import{A as xe}from"./AccessTime-CIxWer1A.js";import{T as ue}from"./Theaters-BWHMVlXO.js";import{A as fe}from"./AdminNowShowingMovies-CkCuSXP4.js";import{D as pe}from"./DateTimePicker-Dqjp7nJq.js";import{f as ge}from"./format-csk1fyom.js";import"./Tabs-BxOdfOC8.js";const je=K(e.jsx("path",{d:"m18 4 2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4z"}),"Movie"),De=({disableCustomTheme:g=!1})=>{var N;const{id:x}=X(),k=ee(),[l,D]=i.useState(""),[M,T]=i.useState(""),[P,u]=i.useState(!1),[m,_]=i.useState(""),[R,A]=i.useState(""),[z,E]=i.useState(0),[F,f]=i.useState(!1),G=a=>{if(!a)return"";try{const t=new Date(a);return ge(t,"yyyy-MM-dd'T'HH:mm")}catch(t){return console.error("Error formatting date:",t),""}},{data:o,isLoading:Y,error:j}=b(["showtime",x],async()=>{try{return(await p.get(`showtime/${x}`)).data}catch(a){throw console.error("Error fetching showtime:",a),a}});i.useEffect(()=>{if(o){console.log("Setting movie and room IDs from showtime:",o);const a=o.data||o;D(a.movieId||""),T(a.roomId||""),a.startTime&&_(G(a.startTime))}},[o]);const{data:h,isLoading:B}=b("movies",async()=>{var t;const a=await p.get("movie");return console.log("Movies API Response:",a.data),Array.isArray(a.data)?a.data:((t=a.data)==null?void 0:t.data)||[]}),{data:L,isLoading:O}=b("rooms",async()=>{var t;const a=await p.get("room");return console.log("Rooms API Response:",a.data),Array.isArray(a.data)?a.data:((t=a.data)==null?void 0:t.data)||[]}),q=a=>{if(D(a),u(!0),h){const t=h.find(d=>d.movieId===a);t&&(A(t.movieName),E(t.duration||120))}f(!1)};i.useEffect(()=>{if(h&&l){const a=h.find(t=>t.movieId===l);a&&(A(a.movieName),E(a.duration||120))}},[h,l]);const Q=a=>{T(a.target.value),u(!0)},U=a=>{a&&(_(a.format("YYYY-MM-DDTHH:mm")),u(!0))},V=a=>{if(!a)return"";try{const t=new Date(a),d=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:00`;return console.log(`Formatted date: ${d}`),d}catch(t){return console.error("Error formatting date:",t),a}},Z=async()=>{try{if(!o)return;const a=o.data||o,t=calculateEndTime(),d={...a,movieId:l,roomId:M,startTime:V(m),endTime:t};await p.put(`showtime/${x}`,d),alert("Lịch chiếu đã được cập nhật thành công!"),u(!1)}catch(a){console.error("Error updating showtime:",a),alert("Đã xảy ra lỗi khi cập nhật lịch chiếu!")}},v=()=>{k("/admin/ql-thoi-gian-chieu")},J=()=>{k(`/admin/ql-thoi-gian-chieu/chinh-sua/${x}`)};return Y||B||O?e.jsx(ae,{}):j?e.jsxs(y,{disableCustomTheme:g,children:[e.jsx(w,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{}),e.jsxs(s,{component:"main",sx:a=>({flexGrow:1,backgroundColor:C(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:[e.jsxs(r,{color:"error",variant:"h6",children:["Error:"," ",j instanceof Error?j.message:"Unknown error"]}),e.jsx(c,{variant:"contained",onClick:v,sx:{mt:2},children:n("admin.showtime_management.come_back")})]})]})]})]}):o?e.jsxs(y,{disableCustomTheme:g,children:[e.jsx(w,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{}),e.jsx(s,{component:"main",sx:a=>({flexGrow:1,backgroundColor:C(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(te,{spacing:2,alignItems:"center",children:[e.jsx(se,{}),e.jsx(oe,{sx:{backgroundColor:"#f5f5f5",color:"#000000",py:3},children:e.jsxs(s,{sx:{mb:3},children:[e.jsxs(r,{variant:"h5",sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(ue,{sx:{mr:1}}),n("admin.showtime_management.detail.title")]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle1",children:n("admin.showtime_management.showtime_id")}),e.jsx(W,{fullWidth:!0,variant:"outlined",size:"small",value:((N=o==null?void 0:o.data)==null?void 0:N.showTimeId)||(o==null?void 0:o.showTimeId)||"",InputProps:{readOnly:!0}})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle1",children:"Phim"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(W,{fullWidth:!0,variant:"outlined",size:"small",value:R,InputProps:{readOnly:!0,startAdornment:l?e.jsx(je,{sx:{mr:1,color:"primary.main"}}):null},placeholder:n("admin.showtime_management.movie_not_selection")}),e.jsx(c,{variant:"contained",onClick:()=>f(!0),sx:{whiteSpace:"nowrap"},children:n("admin.showtime_management.movie_selection")})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle1",children:n("admin.showtime_management.room")}),e.jsx(ne,{fullWidth:!0,size:"small",children:e.jsxs(ie,{value:M,onChange:Q,displayEmpty:!0,children:[e.jsx($,{value:"",children:e.jsx("em",{children:n("admin.showtime_management.no_room")})}),Array.isArray(L)&&L.map(a=>e.jsx($,{value:a.roomId,children:a.roomName||a.name},a.roomId))]})})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(re,{dateAdapter:le,children:e.jsx(pe,{value:m?H(m):null,onChange:U,referenceDate:H("2022-04-17T15:30")})}),e.jsxs(r,{children:["Stored value: ",m??"null"]})]}),l&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle1",children:"Thời lượng"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",bgcolor:"#e8f4fd",px:2,py:1.5,borderRadius:1,border:"1px solid",borderColor:"info.light"},children:[e.jsx(xe,{sx:{mr:1,color:"info.main"}}),e.jsxs(r,{variant:"body1",sx:{fontWeight:"medium"},children:[z," phút"]})]})]}),e.jsxs(s,{sx:{mt:3,display:"flex",justifyContent:"center",gap:2},children:[P?e.jsx(c,{variant:"contained",color:"success",size:"large",onClick:Z,sx:{minWidth:150},children:n("admin.showtime_management.save")}):e.jsx(c,{variant:"contained",color:"primary",size:"large",onClick:J,sx:{minWidth:150},children:n("admin.showtime_management.edit")}),e.jsx(c,{variant:"outlined",size:"large",onClick:v,sx:{minWidth:150},children:n("admin.showtime_management.come_back")})]})]})})]})})]})]}),e.jsxs(ce,{open:F,onClose:()=>f(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(de,{children:n("admin.showtime_management.movie_selection")}),e.jsx(me,{dividers:!0,children:e.jsx(fe,{onMovieSelect:q,selectedMovieId:l})}),e.jsx(he,{children:e.jsx(c,{onClick:()=>f(!1),children:n("admin.showtime_management.close")})})]})]}):e.jsxs(y,{disableCustomTheme:g,children:[e.jsx(w,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{}),e.jsxs(s,{component:"main",sx:a=>({flexGrow:1,backgroundColor:C(a.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:[e.jsx(r,{color:"error",variant:"h6",children:"No data found for this showtime"}),e.jsx(c,{variant:"contained",onClick:v,sx:{mt:2},children:n("admin.showtime_management.come_back")})]})]})]})]})};export{De as default};
