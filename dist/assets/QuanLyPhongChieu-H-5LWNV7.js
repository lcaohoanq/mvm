import{u as Ae,a7 as Pe,aK as Qe,r as a,j as e,C as nt,B as m,T as p,al as s,b as l,a5 as G,x as ot,G as ke,a2 as it,ap as le,aj as H,ak as F,am as O,F as we,I as Le,S as We,f as B,an as K,O as X,l as Y,m as lt,V as n,e as S,L as ct,aL as dt,aM as Ee}from"./index-B0N4umr3.js";import{u as Re}from"./useQuery-CJ73VS18.js";import{M as Ne}from"./ManagementPageLayout-CR8cRzYv.js";import{E as v}from"./EventSeat-DqtIMzW3.js";import{T as ht}from"./TheaterComedy-DB0FJPdj.js";import{C as mt,a as ut}from"./ChiTietPhongChieu-B6Xm1lfR.js";import{T as ce}from"./Theaters-BvsmVZol.js";import{A as y}from"./Alert-Cd53pWcm.js";import xt from"./CreateRoom-C2kp9bCe.js";import"./ArrowBack-DRDJu3Ov.js";import"./CheckCircleOutline-D0uz6DH2.js";import"./Info-BtmbwfDU.js";import"./Tabs-RjomoHR7.js";import"./Snackbar-BsNI6w7x.js";const pt=({rooms:c,onEdit:de,onRefreshData:d})=>{var _e,De;const C=Ae(),g=Pe(),h=Qe(),[J,D]=a.useState(!1),[k,w]=a.useState(!1),[L,u]=a.useState(!1),[j,b]=a.useState(""),[f,he]=a.useState(""),[T,me]=a.useState(!1),[W,ue]=a.useState(!1),[E,xe]=a.useState(!1),[Me,U]=a.useState(!1),[Ve,Z]=a.useState(!1),[$e,ee]=a.useState(!1),[pe,N]=a.useState(null),[ge,A]=a.useState(null),[fe,P]=a.useState(null),[Q,je]=a.useState(""),[R,ye]=a.useState("HCM"),[M,Ce]=a.useState(""),[qe,ze]=a.useState(""),[Ge,te]=a.useState(!1),[V,be]=a.useState(!1),[He,ae]=a.useState(!1),[ve,$]=a.useState(null),[q,se]=a.useState(""),[z,re]=a.useState(""),Fe=()=>{C("/admin/ql-phong-chieu/them-phong-chieu")};a.useEffect(()=>{g.state&&g.state.refresh&&(h.invalidateQueries("rooms"),d&&d(),C(g.pathname,{replace:!0}))},[g,h,C,d]);const Oe=async()=>(await S.get("seattype")).data.data||[],{data:o,isLoading:Be}=Re("seatTypes",Oe);a.useEffect(()=>{o&&o.length>0&&!f&&he(o[0].seatTypeId)},[o,f]);const Ke=t=>{console.log("Handling click for roomId:",t),console.log("Available rooms:",c),t?C(`/admin/ql-phong-chieu/${t}`):console.error("No roomId provided")},Se=t=>{b(t),D(!0)},Xe=t=>{he(t.target.value)},ne=()=>{D(!1),U(!1),N(null)},Ye=async()=>{var t,i;if(!j||!f){n.error("Vui lòng chọn loại ghế");return}me(!0),U(!1),N(null);try{const r=await S.post(`seat/room/${j}?seatTypeId=${f}`,{headers:{accept:"text/plain"}});r.data.isSuccess?(U(!0),n.success("Đã tạo ghế thành công!"),setTimeout(()=>{ne(),h.invalidateQueries("rooms"),h.invalidateQueries(["roomDetail",j]),d&&d()},1500)):(N(r.data.message||"Tạo ghế không thành công"),n.error(`Lỗi: ${r.data.message}`))}catch(r){const x=((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã xảy ra lỗi khi tạo ghế";N(x),n.error(`Lỗi: ${x}`)}finally{me(!1)}},Te=()=>{if(!o||!f)return"";const t=o==null?void 0:o.find(i=>i.seatTypeId===f);return t?t.typeName:""},Je=()=>{if(!o||!f)return 0;const t=o==null?void 0:o.find(i=>i.seatTypeId===f);return t?t.price:0},Ue=t=>{b(t),w(!0)},oe=()=>{w(!1),Z(!1),A(null)},Ze=async()=>{var t,i;if(!j){n.error("Không tìm thấy mã phòng");return}ue(!0),Z(!1),A(null);try{const r=await S.delete(`seat/room/${j}`,{headers:{accept:"text/plain"}});r.data.isSuccess?(Z(!0),n.success("Đã xóa tất cả ghế thành công!"),setTimeout(()=>{oe(),h.invalidateQueries("rooms"),h.invalidateQueries(["roomDetail",j]),d&&d()},1500)):(A(r.data.message||"Xóa ghế không thành công"),n.error(`Lỗi: ${r.data.message}`))}catch(r){const x=((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã xảy ra lỗi khi xóa ghế";A(x),n.error(`Lỗi: ${x}`)}finally{ue(!1)}},et=()=>{u(!0)},ie=()=>{u(!1),ee(!1),P(null),je(""),ye("HCM"),Ce(""),ze("")},tt=t=>{ye(t.target.value)},at=async()=>{var t,i;if(!Q||!R||!M){n.error("Vui lòng điền đầy đủ thông tin");return}xe(!0),ee(!1),P(null);try{const r=await S.post("movietheater",{name:Q,location:R,address:M,image:qe,isDeleted:!1},{headers:{accept:"text/plain","Content-Type":"application/json-patch+json"}});r.data.isSuccess?(ee(!0),n.success("Đã tạo rạp chiếu phim thành công!"),setTimeout(()=>{ie(),h.invalidateQueries("theaters"),h.invalidateQueries("movieTheaters"),h.invalidateQueries("rooms"),d&&d()},1500)):(P(r.data.message||"Tạo rạp chiếu phim không thành công"),n.error(`Lỗi: ${r.data.message}`))}catch(r){const x=((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã xảy ra lỗi khi tạo rạp chiếu phim";P(x),n.error(`Lỗi: ${x}`)}finally{xe(!1)}},st=()=>{te(!0),ae(!1),$(null),se(""),re("")},Ie=()=>{te(!1)},rt=async()=>{var i,r,x;if(!q||!z){n.error("Vui lòng điền đầy đủ thông tin loại ghế");return}const t=parseFloat(z);if(isNaN(t)||t<=0){n.error("Giá ghế phải là số dương");return}be(!0),ae(!1),$(null);try{const I=await S.post("seattype",{typeName:q,price:t},{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(I.data&&I.data.isSuccess)ae(!0),n.success("Đã tạo loại ghế mới thành công!"),se(""),re(""),setTimeout(()=>{h.invalidateQueries("seatTypes"),te(!1)},1500);else{const _=((i=I.data)==null?void 0:i.message)||"Không thể tạo loại ghế mới";$(_),n.error(`Lỗi: ${_}`)}}catch(I){const _=((x=(r=I.response)==null?void 0:r.data)==null?void 0:x.message)||"Đã xảy ra lỗi khi tạo loại ghế mới";$(_),n.error(`Lỗi: ${_}`)}finally{be(!1)}};return e.jsxs(nt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ht,{sx:{fontSize:32,color:"primary.main",mr:2}}),e.jsx(p,{variant:"h4",fontWeight:"bold",children:s("admin.room_management.room_list")})]}),e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(l,{variant:"outlined",color:"info",startIcon:e.jsx(v,{}),onClick:st,children:"Tạo loại ghế mới"}),e.jsx(l,{variant:"outlined",color:"secondary",startIcon:e.jsx(ce,{}),onClick:et,children:s("admin.room_management.create")}),e.jsx(l,{variant:"contained",color:"primary",startIcon:e.jsx(G,{}),onClick:Fe,children:"Tạo phòng chiếu mới"})]})]}),e.jsx(ot,{elevation:0,sx:{borderRadius:2,bgcolor:"#f8f9fa",p:3},children:e.jsx(ke,{container:!0,spacing:3,children:c.map(t=>e.jsx(ke,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(it,{elevation:3,sx:{borderRadius:3,overflow:"hidden",transition:"all 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 12px 20px rgba(0,0,0,0.15)"},height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(m,{sx:{bgcolor:"primary.main",color:"white",py:2,px:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(mt,{sx:{mr:1}}),e.jsx(p,{variant:"h6",fontWeight:"bold",children:t.roomName})]})}),e.jsxs(m,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(v,{sx:{color:"primary.main",fontSize:50,mr:1.5}}),e.jsx(p,{variant:"h3",fontWeight:"medium",children:t.total}),e.jsx(p,{variant:"body1",color:"text.secondary",sx:{ml:1,alignSelf:"flex-end",mb:1},children:s("admin.room_management.seat")})]}),e.jsxs(m,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.jsx(l,{variant:"outlined",color:"primary",fullWidth:!0,onClick:()=>Ke(t.roomId),sx:{borderRadius:2,py:1},children:s("admin.room_management.detail")}),t.total===0?e.jsx(l,{variant:"contained",color:"secondary",fullWidth:!0,onClick:()=>Se(t.roomId),sx:{borderRadius:2,py:1},startIcon:e.jsx(G,{}),children:s("admin.room_management.create_seat")}):e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outlined",color:"secondary",fullWidth:!0,onClick:()=>Se(t.roomId),sx:{borderRadius:2,py:1},startIcon:e.jsx(G,{}),children:s("admin.room_management.add_seat")}),e.jsx(l,{variant:"outlined",color:"error",fullWidth:!0,onClick:()=>Ue(t.roomId),sx:{borderRadius:2,py:1},startIcon:e.jsx(le,{}),children:s("admin.room_management.delete_all_seat")})]})]})]})]})},t.roomId))})}),e.jsxs(H,{open:J,onClose:ne,fullWidth:!0,maxWidth:"xs",children:[e.jsxs(F,{sx:{bgcolor:"primary.main",color:"white",pb:2},children:[e.jsx(v,{sx:{mr:1,verticalAlign:"middle"}}),((_e=c.find(t=>t.roomId===j))==null?void 0:_e.total)===0?s("admin.room_management.create_seat_for_room"):s("admin.room_management.add_seat_for_room")]}),e.jsxs(O,{sx:{pt:3,pb:2},children:[e.jsx(p,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:((De=c.find(t=>t.roomId===j))==null?void 0:De.total)===0?s("admin.room_management.select_seattype_created"):s("admin.room_management.select_seattype_add")}),e.jsxs(we,{fullWidth:!0,sx:{mt:1,mb:2},children:[e.jsx(Le,{children:s("admin.room_management.seattype")}),e.jsx(We,{value:f,onChange:Xe,label:s("admin.room_management.seattype"),disabled:Be||T,children:o==null?void 0:o.map(t=>e.jsxs(B,{value:t.seatTypeId,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(v,{color:"action",fontSize:"small"}),e.jsx("span",{children:t.typeName}),e.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.85rem",color:"#666"},children:[t.price.toLocaleString("vi-VN"),"đ"]})]},t.seatTypeId))})]}),Te()&&e.jsxs(m,{sx:{p:2,bgcolor:"#f5f5f5",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(p,{variant:"body2",children:[s("admin.room_management.selected")," ",e.jsx("strong",{children:Te()})]}),e.jsxs(p,{variant:"body2",color:"primary",fontWeight:"medium",children:[Je().toLocaleString("vi-VN"),"đ"]})]}),Me&&e.jsx(y,{severity:"success",sx:{mb:2},children:s("admin.room_management.created_success")}),pe&&e.jsx(y,{severity:"error",sx:{mb:2},children:pe})]}),e.jsxs(K,{sx:{px:3,pb:3},children:[e.jsx(l,{onClick:ne,disabled:T,variant:"outlined",children:s("admin.room_management.cancel")}),e.jsx(l,{onClick:Ye,variant:"contained",disabled:T||!f,startIcon:T?e.jsx(X,{size:20}):e.jsx(G,{}),children:T?"Đang tạo...":"Tạo ghế"})]})]}),e.jsxs(H,{open:k,onClose:oe,fullWidth:!0,maxWidth:"xs",children:[e.jsxs(F,{sx:{bgcolor:"error.main",color:"white",pb:2},children:[e.jsx(le,{sx:{mr:1,verticalAlign:"middle"}}),s("admin.room_management.delete_all_seat")]}),e.jsxs(O,{sx:{pt:3,pb:2},children:[e.jsx(p,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:s("admin.room_management.confirm_delete")}),e.jsx(m,{sx:{p:2,bgcolor:"#fff8e1",borderRadius:1,border:"1px solid #ffe57f",mb:2},children:e.jsxs(p,{variant:"body2",color:"warning.dark",children:[e.jsx("strong",{children:s("admin.room_management.warming")})," ",s("admin.room_management.warming_delete")]})}),Ve&&e.jsx(y,{severity:"success",sx:{mb:2},children:s("admin.room_management.delete_success")}),ge&&e.jsx(y,{severity:"error",sx:{mb:2},children:ge})]}),e.jsxs(K,{sx:{px:3,pb:3},children:[e.jsx(l,{onClick:oe,disabled:W,variant:"outlined",children:"Hủy"}),e.jsx(l,{onClick:Ze,variant:"contained",color:"error",disabled:W,startIcon:W?e.jsx(X,{size:20,color:"inherit"}):e.jsx(le,{}),children:W?"Đang xóa...":"Xác nhận xóa"})]})]}),e.jsxs(H,{open:L,onClose:ie,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(F,{sx:{bgcolor:"secondary.main",color:"white",pb:2},children:[e.jsx(ce,{sx:{mr:1,verticalAlign:"middle"}}),"Tạo rạp chiếu phim mới"]}),e.jsxs(O,{sx:{pt:3,pb:2},children:[e.jsx(p,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Vui lòng nhập thông tin cho rạp chiếu phim mới"}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Y,{fullWidth:!0,label:"Tên rạp chiếu phim",value:Q,onChange:t=>je(t.target.value),required:!0}),e.jsxs(we,{fullWidth:!0,required:!0,children:[e.jsx(Le,{children:"Địa điểm"}),e.jsxs(We,{value:R,onChange:tt,label:"Địa điểm",children:[e.jsx(B,{value:"HCM",children:"HCM"}),e.jsx(B,{value:"BD",children:"BD"}),e.jsx(B,{value:"Củ Chi",children:"Củ Chi"})]})]}),e.jsx(Y,{fullWidth:!0,label:"Địa chỉ chi tiết",value:M,onChange:t=>Ce(t.target.value),required:!0,multiline:!0,rows:2})]}),$e&&e.jsx(y,{severity:"success",sx:{mt:2,mb:1},children:"Tạo rạp chiếu phim thành công!"}),fe&&e.jsx(y,{severity:"error",sx:{mt:2,mb:1},children:fe})]}),e.jsxs(K,{sx:{px:3,pb:3},children:[e.jsx(l,{onClick:ie,disabled:E,variant:"outlined",children:"Hủy"}),e.jsx(l,{onClick:at,variant:"contained",color:"secondary",disabled:E||!Q||!R||!M,startIcon:E?e.jsx(X,{size:20}):e.jsx(ce,{}),children:E?"Đang tạo...":"Tạo rạp chiếu phim"})]})]}),e.jsxs(H,{open:Ge,onClose:Ie,fullWidth:!0,maxWidth:"xs",children:[e.jsxs(F,{sx:{bgcolor:"info.main",color:"white",pb:2},children:[e.jsx(v,{sx:{mr:1,verticalAlign:"middle"}}),"Tạo loại ghế mới"]}),e.jsxs(O,{sx:{pt:3,pb:2},children:[e.jsx(p,{variant:"body2",sx:{mb:3,color:"text.secondary"},children:"Vui lòng nhập thông tin cho loại ghế mới"}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Y,{fullWidth:!0,label:"Tên loại ghế",value:q,onChange:t=>se(t.target.value),required:!0,placeholder:"VD: Ghế VIP, Ghế đôi, Ghế thường..."}),e.jsx(Y,{fullWidth:!0,label:"Giá ghế",type:"number",value:z,onChange:t=>re(t.target.value),required:!0,placeholder:"VD: 100000",InputProps:{endAdornment:e.jsx(lt,{position:"end",children:"VND"})}})]}),He&&e.jsx(y,{severity:"success",sx:{mt:2,mb:1},children:"Tạo loại ghế mới thành công!"}),ve&&e.jsx(y,{severity:"error",sx:{mt:2,mb:1},children:ve})]}),e.jsxs(K,{sx:{px:3,pb:3},children:[e.jsx(l,{onClick:Ie,disabled:V,variant:"outlined",children:"Hủy"}),e.jsx(l,{onClick:rt,variant:"contained",color:"info",disabled:V||!q||!z,startIcon:V?e.jsx(X,{size:20}):e.jsx(v,{}),children:V?"Đang tạo...":"Tạo loại ghế"})]})]})]})},Lt=()=>{const c=Pe(),de=Ae(),d=Qe(),C=c.pathname.split("/").length>3,g=!C,h=async()=>{try{const u=await S.get("room");return console.log("API Response:",u.data),(u.data.data||[]).map(b=>({roomId:b.roomId,roomName:b.roomName,total:b.total}))}catch(u){throw console.error("Error fetching rooms:",u),u}},{data:J=[],isLoading:D,error:k,refetch:w}=Re("PhongChieuData",h,{enabled:g}),L=()=>{g&&(d.invalidateQueries("PhongChieuData"),d.invalidateQueries("rooms"),w())};return a.useEffect(()=>{(c.state&&c.state.refresh||c.pathname.endsWith("/ql-phong-chieu")&&c.key)&&g&&(console.log("Auto refreshing room data..."),L(),c.state&&c.state.refresh&&de(c.pathname,{replace:!0,state:{}}))},[c,g]),D&&g?e.jsx(ct,{}):k?e.jsx(Ne,{children:e.jsxs("div",{children:["Error: ",k.message]})}):e.jsx(e.Fragment,{children:C?e.jsxs(dt,{children:[e.jsx(Ee,{path:"/:id",element:e.jsx(ut,{})}),e.jsx(Ee,{path:"/them-phong-chieu",element:e.jsx(xt,{})})]}):e.jsx(Ne,{children:e.jsx(pt,{rooms:J,onEdit:u=>console.log("Edit room:",u),onRefreshData:L})})})};export{Lt as default};
