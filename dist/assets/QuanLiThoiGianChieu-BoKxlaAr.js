import{u as h,j as t,B as l,T as u,b as c,ap as g,an as f,L as T,e as p}from"./index-D08WwhE9.js";import{u as x}from"./useQuery-BzXUVCug.js";import{M as N}from"./ManagementPageLayout-B4VkQ5br.js";import{f as y}from"./format-csk1fyom.js";const v=({showTimes:e})=>{const o=h(),i=r=>{console.log("Handling click for showTimeId:",r),console.log("Available showTimes:",e),r?o(`/admin/ql-thoi-gian-chieu/${r}`):console.error("No showTimeId provided")},a=r=>{try{return y(new Date(r),"dd/MM/yyyy HH:mm")}catch{return r||"N/A"}},n=e.map(r=>{var m,d;return{...r,id:r.showTimeId,movieName:((m=r.movie)==null?void 0:m.movieName)||"N/A",roomName:((d=r.room)==null?void 0:d.roomName)||"N/A",formattedStartTime:a(r.startTime),formattedEndTime:a(r.endTime)}}),s=[{field:"movieName",headerName:"Tên phim",flex:1,sortable:!0},{field:"roomName",headerName:"Tên phòng chiếu",width:180,sortable:!0},{field:"formattedStartTime",headerName:"Thời gian chiếu",width:180,sortable:!0},{field:"formattedEndTime",headerName:"Thời gian kết thúc",width:180,sortable:!0},{field:"actions",headerName:"Chi tiết",width:120,sortable:!1,renderCell:r=>t.jsx(c,{variant:"outlined",size:"small",startIcon:t.jsx(f,{}),onClick:()=>i(r.row.showTimeId),children:"Chi tiết"})}];return t.jsxs(t.Fragment,{children:[t.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",padding:"1rem"},children:[t.jsx(u,{variant:"h5",sx:{textAlign:"left",flexGrow:1},children:"Danh sách thời gian chiếu"}),t.jsx(c,{variant:"contained",color:"primary",sx:{flexShrink:0},onClick:()=>{o("/admin/ql-thoi-gian-chieu/them-thoi-gian-chieu")},children:"Thêm thời gian chiếu"})]}),t.jsx(l,{sx:{height:500,width:"100%"},children:t.jsx(g,{rows:n,columns:s,pagination:!0,pageSizeOptions:[5,10,25,50],initialState:{pagination:{paginationModel:{pageSize:10,page:0}},sorting:{sortModel:[{field:"formattedStartTime",sort:"desc"}]}},getRowId:r=>r.id,density:"standard",disableRowSelectionOnClick:!0,autoHeight:!0})})]})},I=async()=>{try{const e=await p.get("showtime");return e.data.isSuccess?e.data.data||[]:(console.error("API returned error:",e.data.message),[])}catch(e){return console.error("Error fetching showtimes:",e),[]}},S=e=>{var i,a;const o=e.startTime instanceof Date?e.startTime.toISOString():String(e.startTime);return{id:e.showTimeId,showTimeId:e.showTimeId,movieId:e.movieId,roomId:e.roomId,startTime:o,endTime:e.endTime,movie:{movieName:((i=e.movie)==null?void 0:i.movieName)||"N/A"},room:{roomName:((a=e.room)==null?void 0:a.roomName)||"N/A"}}},A=()=>{h();const{data:e=[],isLoading:o,error:i}=x("ThoiGianChieuData",I,{onError:n=>{console.error("Query error:",n)},retry:1});if(o)return t.jsx(T,{});const a=(e==null?void 0:e.map(S))||[];return t.jsx(N,{children:t.jsx(v,{showTimes:a,onEdit:n=>{const s=e.find(r=>r.showTimeId===n);console.log("Found showtime:",s)}})})};export{A as default};
