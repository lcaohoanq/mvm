import{a7 as Y,u as F,g as Q,r as l,a6 as Z,V as C,j as e,U as T,W as S,B as t,X as B,Y as w,O as _,T as s,Z as J,_ as ee,$ as se,x as m,G as h,aa as k,b as N}from"./index-D08WwhE9.js";import{C as te}from"./CheckCircleOutline-faW2Pzg2.js";import{H as ne}from"./Home-Bydhthu2.js";import{A as ie}from"./ArrowBack-BURlnvvZ.js";import{A as I}from"./Alert-CsmeuHh2.js";import{C as re}from"./CancelOutlined-BwGRl6Op.js";const xe=()=>{const V=Y(),g=F(),{userDetails:u}=Q(),[G,A]=l.useState("success"),{connection:j,joinGroup:p,leaveGroup:f,isConnected:a}=Z(),[v,P]=l.useState(!1),[y]=l.useState(!1),{selectedTime:E="Not selected",selectedDate:R="Not selected",tickets:b=[],seats:W=[],showTimeId:H="",selectedSeatsInfo:d=[],movieData:n=null,roomName:M="",totalPrice:q=0,selectedUser:c=null,paymentMethod:D="money"}=V.state||{},U=(n==null?void 0:n.movieName)||"Phim Mặc Định",z=R,L=E,r=H||"",O=()=>{g("/admin/ql-ban-ve")},$=()=>{g("/admin/dashboard")},[K,X]=l.useState(a);return l.useEffect(()=>{X(a)},[a]),l.useEffect(()=>{if(!a||!r||!j){console.log("Waiting for SignalR connection or missing showTimeId...");return}const o=u==null?void 0:u.userId;return p(r).then(()=>{if(console.log(`Admin confirmation joined ShowTime group: ${r}`),!v&&(d==null?void 0:d.length)>0){const i=d.map(x=>({TicketId:x.ticketId,Version:x.version}));console.log("Confirming seat purchase:",i),j.invoke("ConfirmSeatPurchase",i,r,o).then(()=>{console.log("Seats marked as purchased:",i),P(!0),C.success("Ghế đã được đặt thành công!")}).catch(x=>{console.error("Error finalizing seat purchase:",x),C.error("Không thể cập nhật trạng thái ghế: "+x.message),A("failure")})}}).catch(i=>console.error("Error joining ShowTime group:",i)),()=>{a&&r&&f(r).then(()=>console.log(`Admin confirmation left ShowTime group: ${r}`)).catch(i=>console.error("Error leaving ShowTime group:",i))}},[a,r,j,d,v,p,f]),K?e.jsxs(T,{disableCustomTheme:y,children:[e.jsx(S,{enableColorScheme:!0}),e.jsxs(t,{sx:{display:"flex",height:"100vh"},children:[e.jsx(B,{}),e.jsxs(t,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(w,{}),e.jsx(t,{component:"main",sx:o=>({flexGrow:1,backgroundColor:J(o.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(ee,{spacing:3,children:[e.jsx(se,{}),e.jsxs(m,{elevation:2,sx:{width:"100%",borderRadius:2,overflow:"hidden"},children:[e.jsx(t,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(s,{variant:"h5",fontWeight:"bold",children:"Xác Nhận Đặt Vé"})}),G==="success"?e.jsxs(I,{severity:"success",icon:e.jsx(te,{fontSize:"inherit"}),sx:{mx:3,mt:3},children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:"Đặt Vé Thành Công!"}),e.jsx(s,{variant:"body2",children:"Vé đã được lưu vào hệ thống."})]}):e.jsxs(I,{severity:"error",icon:e.jsx(re,{fontSize:"inherit"}),sx:{mx:3,mt:3},children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:"Đặt Vé Thất Bại!"}),e.jsx(s,{variant:"body2",children:"Đã xảy ra lỗi khi xử lý đặt vé. Vui lòng thử lại."})]}),e.jsx(t,{sx:{p:3},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsxs(m,{elevation:1,sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(t,{component:"img",src:n==null?void 0:n.image,alt:(n==null?void 0:n.movieName)||"Movie Poster",sx:{width:"100%",borderRadius:2,objectFit:"contain",maxHeight:400,mb:2}}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:U}),e.jsx(k,{sx:{my:2}}),e.jsxs(t,{sx:{mt:2},children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Phòng chiếu:"})," ",M]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Ngày chiếu:"})," ",z]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Giờ chiếu:"})," ",L]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Ghế:"})," ",W.join(", ")||"Chưa chọn ghế"]})]})]})}),e.jsxs(h,{item:!0,xs:12,md:8,children:[c&&e.jsxs(m,{elevation:1,sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Thông Tin Khách Hàng"}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsxs(h,{item:!0,xs:12,sm:6,children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Tài khoản:"})," ",c.userName]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Email:"})," ",c.email]})]}),e.jsxs(h,{item:!0,xs:12,sm:6,children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"CMND/CCCD:"})," ",c.idCard]}),e.jsxs(s,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Số điện thoại:"})," ",c.phoneNumber]})]})]}),e.jsxs(t,{sx:{mt:2},children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:"Điểm hiện tại:"})," ",c.point]}),e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:"Phương thức thanh toán:"})," ",D==="money"?"Tiền mặt":"Sử dụng điểm"]})]})]}),e.jsxs(m,{elevation:1,sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Chi Tiết Thanh Toán"}),b.length>0&&e.jsxs(t,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Vé đã mua:"}),b.map((o,i)=>e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{children:[o.name," x",o.quantity]}),e.jsxs(s,{children:[(o.price*o.quantity).toLocaleString("vi-VN"),"đ"]})]},i))]}),e.jsx(k,{sx:{my:2}}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{variant:"h6",children:"Tổng thanh toán:"}),e.jsxs(s,{variant:"h6",color:"primary",fontWeight:"bold",children:[q.toLocaleString("vi-VN"),"đ"]})]})]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(N,{variant:"outlined",startIcon:e.jsx(ie,{}),onClick:O,children:"Quay lại bán vé"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:$,children:"Về Dashboard"})]})]})]})})]})]})})]})]})]}):e.jsxs(T,{disableCustomTheme:y,children:[e.jsx(S,{enableColorScheme:!0}),e.jsxs(t,{sx:{display:"flex",height:"100vh"},children:[e.jsx(B,{}),e.jsxs(t,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(w,{}),e.jsxs(t,{component:"main",sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(_,{color:"primary"}),e.jsx(s,{sx:{ml:2},children:"Đang kết nối đến máy chủ..."})]})]})]})]})};export{xe as default};
