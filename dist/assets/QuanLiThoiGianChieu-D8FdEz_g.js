import{u as x,a as v,j as a,b as g,ao as y,B as d,T as u,aq as N,a7 as w,aK as j,r as f,L as S,e as I}from"./index-B2eA6uDr.js";import{u as b}from"./useQuery-CZbVYsZq.js";import{M as C}from"./ManagementPageLayout-DVnl9qIc.js";import{f as A}from"./format-csk1fyom.js";const D=({showTimes:e,onRefreshData:r})=>{const o=x(),{t:i}=v(),l=t=>{console.log("Handling click for showTimeId:",t),console.log("Available showTimes:",e),t?o(`/admin/ql-thoi-gian-chieu/${t}`):console.error("No showTimeId provided")},n=t=>{try{return A(new Date(t),"dd/MM/yyyy HH:mm")}catch{return t||"N/A"}},c=e.map(t=>{var m,s;return{...t,id:t.showTimeId,movieName:((m=t.movie)==null?void 0:m.movieName)||"N/A",roomName:((s=t.room)==null?void 0:s.roomName)||"N/A",formattedStartTime:n(t.startTime),formattedEndTime:n(t.endTime)}}),h=[{field:"movieName",headerName:i("admin.movie_management.detail.name"),flex:1,sortable:!0},{field:"roomName",headerName:i("admin.showtime_management.name"),width:180,sortable:!0},{field:"formattedStartTime",headerName:i("admin.showtime_management.start_time"),width:180,sortable:!0},{field:"formattedEndTime",headerName:i("admin.showtime_management.end_time"),width:180,sortable:!0},{field:"actions",headerName:"Chi tiết",width:120,sortable:!1,renderCell:t=>a.jsx(g,{variant:"outlined",size:"small",startIcon:a.jsx(y,{}),onClick:()=>l(t.row.showTimeId),children:"Chi tiết"})}];return a.jsxs(a.Fragment,{children:[a.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",padding:"1rem"},children:[a.jsx(u,{variant:"h5",sx:{textAlign:"left",flexGrow:1},children:i("admin.showtime_management.showtime_list")}),a.jsx(g,{variant:"contained",color:"primary",sx:{flexShrink:0},onClick:()=>{o("/admin/ql-thoi-gian-chieu/them-thoi-gian-chieu")},children:i("admin.showtime_management.add_new")})]}),a.jsx(d,{sx:{height:500,width:"100%"},children:a.jsx(N,{rows:c,columns:h,pagination:!0,pageSizeOptions:[5,10,25,50],initialState:{pagination:{paginationModel:{pageSize:10,page:0}},sorting:{sortModel:[{field:"formattedStartTime",sort:"desc"}]}},getRowId:t=>t.id,density:"standard",disableRowSelectionOnClick:!0,autoHeight:!0})})]})},E=async()=>{try{const e=await I.get("showtime");return e.data.isSuccess?e.data.data||[]:(console.error("API returned error:",e.data.message),[])}catch(e){return console.error("Error fetching showtimes:",e),[]}},_=e=>{var o,i;const r=e.startTime instanceof Date?e.startTime.toISOString():String(e.startTime);return{id:e.showTimeId,showTimeId:e.showTimeId,movieId:e.movieId,roomId:e.roomId,startTime:r,endTime:e.endTime,movie:{movieName:((o=e.movie)==null?void 0:o.movieName)||"N/A"},room:{roomName:((i=e.room)==null?void 0:i.roomName)||"N/A"}}},R=()=>{const e=x(),r=w(),o=j(),[i,l]=f.useState(null),{data:n=[],isLoading:c,error:h,refetch:t}=b("ThoiGianChieuData",E,{onError:s=>{console.error("Query error:",s)},retry:1});if(f.useEffect(()=>{r.state&&r.state.refresh&&(console.log("Refresh signal detected, refetching data..."),o.invalidateQueries("ThoiGianChieuData"),t(),r.state.message&&l(r.state.message),e(r.pathname,{replace:!0,state:{}}))},[r,o,t,e]),c)return a.jsx(S,{});const m=(n==null?void 0:n.map(_))||[];return a.jsxs(C,{children:[h?a.jsx(d,{sx:{textAlign:"center",mt:3,mb:2},children:a.jsx(u,{color:"error",variant:"body1",children:"Không thể tải dữ liệu lịch chiếu. Bạn vẫn có thể tạo mới lịch chiếu."})}):n.length===0?a.jsx(d,{sx:{textAlign:"center",mt:3,mb:2},children:a.jsx(u,{variant:"body1",children:"Không có dữ liệu lịch chiếu. Vui lòng tạo mới lịch chiếu."})}):null,a.jsx(D,{showTimes:m,onEdit:s=>{const T=n.find(p=>p.showTimeId===s);console.log("Found showtime:",T)},onRefreshData:()=>{o.invalidateQueries("ThoiGianChieuData"),t()}})]})};export{R as default};
