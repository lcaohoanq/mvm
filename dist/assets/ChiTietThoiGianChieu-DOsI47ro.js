import{c as _,j as e,a0 as J,u as ee,r as i,L as te,U as v,W as y,B as s,X as S,Y as w,Z as C,T as o,b as c,_ as ae,$ as se,C as re,l as N,F as ie,S as oe,f as R,aE as ne,aF as le,aC as Y,aj as ce,ak as de,al as he,am as me,e as u}from"./index-hKNTF3Dt.js";import{u as I}from"./useQuery-BjwSv2bA.js";import{A as xe}from"./AccessTime-DIQ3aLeV.js";import{T as ue}from"./Theaters-DeYc14I_.js";import{A as fe}from"./AdminNowShowingMovies-DwPkYBnP.js";import{D as pe}from"./DateTimePicker-niQYJXu0.js";import{f as ge}from"./format-csk1fyom.js";import"./Tabs-B_H17Iz4.js";const je=_(e.jsx("path",{d:"m18 4 2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4z"}),"Movie"),Me=({disableCustomTheme:f=!1})=>{var H;const{id:h}=J(),D=ee(),[n,T]=i.useState(""),[M,b]=i.useState(""),[$,m]=i.useState(!1),[l,k]=i.useState(""),[z,A]=i.useState(""),[E,L]=i.useState(0),[G,x]=i.useState(!1),F=t=>{if(!t)return"";try{const a=new Date(t);return ge(a,"yyyy-MM-dd'T'HH:mm")}catch(a){return console.error("Error formatting date:",a),""}},{data:r,isLoading:B,error:p}=I(["showtime",h],async()=>{try{return(await u.get(`showtime/${h}`)).data}catch(t){throw console.error("Error fetching showtime:",t),t}});i.useEffect(()=>{if(r){console.log("Setting movie and room IDs from showtime:",r);const t=r.data||r;T(t.movieId||""),b(t.roomId||""),t.startTime&&k(F(t.startTime))}},[r]);const{data:d,isLoading:O}=I("movies",async()=>{var a;const t=await u.get("movie");return console.log("Movies API Response:",t.data),Array.isArray(t.data)?t.data:((a=t.data)==null?void 0:a.data)||[]}),{data:P,isLoading:Q}=I("rooms",async()=>{var a;const t=await u.get("room");return console.log("Rooms API Response:",t.data),Array.isArray(t.data)?t.data:((a=t.data)==null?void 0:a.data)||[]}),q=t=>{if(T(t),m(!0),d){const a=d.find(j=>j.movieId===t);a&&(A(a.movieName),L(a.duration||120))}x(!1)};i.useEffect(()=>{if(d&&n){const t=d.find(a=>a.movieId===n);t&&(A(t.movieName),L(t.duration||120))}},[d,n]);const U=t=>{b(t.target.value),m(!0)},Z=t=>{t&&(k(t.format("YYYY-MM-DDTHH:mm")),m(!0))},W=t=>{if(!t)return"";const a=new Date(t);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}T${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:00.000Z`},K=()=>{if(!l)return"";const t=new Date(l),a=new Date(t.getTime()+E*6e4);return W(a.toISOString())},V=async()=>{try{if(!r)return;const t=r.data||r,a=K(),j={...t,movieId:n,roomId:M,startTime:W(l),endTime:a};await u.put(`showtime/${h}`,j),alert("Lịch chiếu đã được cập nhật thành công!"),m(!1)}catch(t){console.error("Error updating showtime:",t),alert("Đã xảy ra lỗi khi cập nhật lịch chiếu!")}},g=()=>{D("/admin/ql-thoi-gian-chieu")},X=()=>{D(`/admin/ql-thoi-gian-chieu/chinh-sua/${h}`)};return B||O||Q?e.jsx(te,{}):p?e.jsxs(v,{disableCustomTheme:f,children:[e.jsx(y,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(w,{}),e.jsxs(s,{component:"main",sx:t=>({flexGrow:1,backgroundColor:C(t.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:[e.jsxs(o,{color:"error",variant:"h6",children:["Error:"," ",p instanceof Error?p.message:"Unknown error"]}),e.jsx(c,{variant:"contained",onClick:g,sx:{mt:2},children:"Quay lại"})]})]})]})]}):r?e.jsxs(v,{disableCustomTheme:f,children:[e.jsx(y,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(w,{}),e.jsx(s,{component:"main",sx:t=>({flexGrow:1,backgroundColor:C(t.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:e.jsxs(ae,{spacing:2,alignItems:"center",children:[e.jsx(se,{}),e.jsx(re,{sx:{backgroundColor:"#f5f5f5",color:"#000000",py:3},children:e.jsxs(s,{sx:{mb:3},children:[e.jsxs(o,{variant:"h5",sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(ue,{sx:{mr:1}}),"Chi tiết lịch chiếu"]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(o,{variant:"subtitle1",children:"Mã lịch chiếu"}),e.jsx(N,{fullWidth:!0,variant:"outlined",size:"small",value:((H=r==null?void 0:r.data)==null?void 0:H.showTimeId)||(r==null?void 0:r.showTimeId)||"",InputProps:{readOnly:!0}})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(o,{variant:"subtitle1",children:"Phim"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(N,{fullWidth:!0,variant:"outlined",size:"small",value:z,InputProps:{readOnly:!0,startAdornment:n?e.jsx(je,{sx:{mr:1,color:"primary.main"}}):null},placeholder:"Chưa chọn phim"}),e.jsx(c,{variant:"contained",onClick:()=>x(!0),sx:{whiteSpace:"nowrap"},children:"Chọn phim"})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(o,{variant:"subtitle1",children:"Phòng chiếu"}),e.jsx(ie,{fullWidth:!0,size:"small",children:e.jsxs(oe,{value:M,onChange:U,displayEmpty:!0,children:[e.jsx(R,{value:"",children:e.jsx("em",{children:"Không có phòng"})}),Array.isArray(P)&&P.map(t=>e.jsx(R,{value:t.roomId,children:t.roomName||t.name},t.roomId))]})})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(ne,{dateAdapter:le,children:e.jsx(pe,{value:l?Y(l):null,onChange:Z,referenceDate:Y("2022-04-17T15:30")})}),e.jsxs(o,{children:["Stored value: ",l??"null"]})]}),n&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(o,{variant:"subtitle1",children:"Thời lượng"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",bgcolor:"#e8f4fd",px:2,py:1.5,borderRadius:1,border:"1px solid",borderColor:"info.light"},children:[e.jsx(xe,{sx:{mr:1,color:"info.main"}}),e.jsxs(o,{variant:"body1",sx:{fontWeight:"medium"},children:[E," phút"]})]})]}),e.jsxs(s,{sx:{mt:3,display:"flex",justifyContent:"center",gap:2},children:[$?e.jsx(c,{variant:"contained",color:"success",size:"large",onClick:V,sx:{minWidth:150},children:"Lưu thay đổi"}):e.jsx(c,{variant:"contained",color:"primary",size:"large",onClick:X,sx:{minWidth:150},children:"Chỉnh sửa"}),e.jsx(c,{variant:"outlined",size:"large",onClick:g,sx:{minWidth:150},children:"Quay lại"})]})]})})]})})]})]}),e.jsxs(ce,{open:G,onClose:()=>x(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(de,{children:"Chọn phim chiếu"}),e.jsx(he,{dividers:!0,children:e.jsx(fe,{onMovieSelect:q,selectedMovieId:n})}),e.jsx(me,{children:e.jsx(c,{onClick:()=>x(!1),children:"Đóng"})})]})]}):e.jsxs(v,{disableCustomTheme:f,children:[e.jsx(y,{enableColorScheme:!0}),e.jsxs(s,{sx:{display:"flex",height:"100vh"},children:[e.jsx(S,{}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(w,{}),e.jsxs(s,{component:"main",sx:t=>({flexGrow:1,backgroundColor:C(t.palette.background.default,1),overflowY:"auto",px:3,py:2}),children:[e.jsx(o,{color:"error",variant:"h6",children:"No data found for this showtime"}),e.jsx(c,{variant:"contained",onClick:g,sx:{mt:2},children:"Quay lại"})]})]})]})]})};export{Me as default};
